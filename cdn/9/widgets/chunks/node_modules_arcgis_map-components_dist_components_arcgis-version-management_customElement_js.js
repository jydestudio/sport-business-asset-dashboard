/*! For license information please see node_modules_arcgis_map-components_dist_components_arcgis-version-management_customElement_js.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["node_modules_arcgis_map-components_dist_components_arcgis-version-management_customElement_js"],{8355:(e,i,t)=>{t.r(i),t.d(i,{ArcgisVersionManagement:()=>m});var s=t(8019),n=t(6752),o=t(4312),r=t(1683),a=t(498),l=t(396),c=t(1881),d=t(7459);const h=t(3826).AH`@layer{.initial-version-invalid-block{margin-bottom:1rem}.calcite-combobox-item{width:330px}.calcite-flow-widget{width:350px}calcite-block{margin:0}calcite-pagination{justify-content:center}}`,v=(0,d.m)(r.default),g="map-components:version-management";class m extends a.WF{constructor(){super(...arguments),this.flowElement=(0,l._)(),this.messages=(0,c.u)({blocking:!0}),this.viewModel=v(this),this._isInitialVersionInvalid=new Map,this._initialVersionInfos=[],this._showInvalidFeatureServiceNotice=!1,this.allowEditingDisabled=!1,this.autoDestroyDisabled=!1,this.closable=!1,this.pageSize=5,this.position="top-right",this.state=this.viewModel.state,this.versioningStates=this.viewModel.versioningStates,this.view=this.viewModel.view,this.arcgisReady=(0,a.lh)(),this.arcgisVersioningStateChanged=(0,a.lh)()}static{this.properties={versionList:16,_showInvalidFeatureServiceNotice:16,allowEditingDisabled:5,autoDestroyDisabled:5,closable:7,initialVersionInfos:0,icon:3,label:3,messageOverrides:0,mode:1,pageSize:9,position:1,referenceElement:1,state:3,versioningStates:0,view:0}}static{this.styles=h}static{this.shadowRootOptions=a.Iq}get initialVersionInfos(){return this._initialVersionInfos}set initialVersionInfos(e){this._initialVersionInfos=e.map((e=>({...e,url:this._removeTrailingSlash(e.url)})))}async destroy(){await this.manager.destroy()}async load(){(0,o.once)((()=>"ready"===this.viewModel.state)).then((()=>{this.initialVersionInfos.forEach((e=>{try{this._changeToInitialVersion(e)}catch(e){console.error(e)}}))})),this.manager.onLifecycle((()=>[(0,o.watch)((()=>this.viewModel.state),(e=>{const{flowElement:{value:i},versionList:t}=this,s=i?.getElementsByTagName("arcgis-version-management-version-properties")[0];if("disabled"===e&&i)return s&&this._removeVersionPropertiesFlowItem(i),void(t&&this._removeVersionListFlowItem(i));t&&(t.versionListElementProps={...t.versionListElementProps,executionError:this.viewModel.executionError},t.versionListElementProps={...t.versionListElementProps,state:e}),s&&(s.versionPropertiesElementProps={...s.versionPropertiesElementProps,state:e})}))]))}_removeTrailingSlash(e){return e.replace(/\/+$/u,"")}_createVersionPropertiesFlowItem(e,i){const{closable:t,flowElement:{value:s},viewModel:n,viewModel:{state:o}}=this,r=document.createElement("arcgis-version-management-version-properties");return r.versionPropertiesElementProps={closable:t,currentUser:n.userLookup.get(e),hasAdvEditingUte:n.advancedEditingUserTypeExtensionLookup.get(e),isVersionAdministrator:n.versionAdministratorLookup.get(e),serviceUrl:e,state:o,strings:this.messages,versionInfo:i},r.selected=!0,r.showBackButton=!0,r.addEventListener("arcgisCreateVersion",(i=>{const{createVersionParameters:t,switchToVersion:o}=i.detail;n.createVersion(t).then((async i=>{i&&this.arcgisVersioningStateChanged.emit({type:"version-created",versionIdentifier:i.versionIdentifier,versioningState:n.versioningStateLookup.get(e)}),o&&await this.viewModel.changeVersion(e,i.versionIdentifier.name,i.versionIdentifier.guid).then((t=>{t&&this.arcgisVersioningStateChanged.emit({type:"version-switched",versionIdentifier:i.versionIdentifier,versioningState:n.versioningStateLookup.get(e)})})),await this._refreshVersionList(e)})).finally((()=>{s&&this._removeVersionPropertiesFlowItem(s)}))})),r.addEventListener("arcgisAlterVersion",(async i=>{const{flowElement:{value:t}}=this,{alterVersionParameters:s}=i.detail;await n.alterVersion(s).then((async i=>{i&&this.arcgisVersioningStateChanged.emit({type:"version-changed",versionIdentifier:s.versionIdentifier,versioningState:n.versioningStateLookup.get(e)}),await this._refreshVersionList(e)})).finally((()=>{t&&this._removeVersionPropertiesFlowItem(t)}))})),r.addEventListener("arcgisFlowItemBack",(()=>{this._removeVersionPropertiesFlowItem(this.flowElement.value)})),r.addEventListener("calciteFlowItemBack",(e=>{e.preventDefault(),this._removeVersionPropertiesFlowItem(this.flowElement.value),this.versionList&&(this.versionList.selected=!0)})),r.addEventListener("calciteFlowItemClose",(()=>{this._handleFlowItemClose()})),r}_getLoadError(e){const{messages:i}=this;switch(e){case"no-feature-services":return i.loadErrors.noFeatureServices;case"no-view-property":return i.loadErrors.noViewProperty;default:return e}}_changeToInitialVersion(e){const{_isInitialVersionInvalid:i,viewModel:t}=this,{url:s,name:n}=e,o=t.versioningStateLookup.get(s);if(!o)throw this._showInvalidFeatureServiceNotice=!0,new Error(`${g} - no versioning state found for feature service ${s}`);const r=o?.versionInfos.find((e=>e.versionIdentifier.name===n));if(!r)throw i.set(s,!0),new Error(`${g} - version ${n} not found in the versioning state for feature service ${s}`);const a=r.versionIdentifier,l=o?.currentVersionInfo?.versionIdentifier;a.guid!==l?.guid&&t.changeVersion(s,a.name,a.guid)}_handleFlowItemClose(){const e=document.querySelector("arcgis-version-management");e.parentElement?.removeChild(e)}async _handleNewVersionAction(e){const i=this._createVersionPropertiesFlowItem(e.detail.serviceUrl,void 0);this.flowElement.value?.appendChild(i),this.versionList&&(this.versionList.selected=!1)}async _handleManageVersionAction(e){const{actionType:i,serviceUrl:t,versionInfo:s}=e.detail,{viewModel:n,flowElement:o}=this;switch(i){case"changeVersion":n.changeVersion(t,s.versionIdentifier.name,s.versionIdentifier.guid).then((e=>{e&&this.arcgisVersioningStateChanged.emit({type:"version-switched",versionIdentifier:s.versionIdentifier,versioningState:n.versioningStateLookup.get(t)});const{versionList:i}=this;i&&(i.versionListElementProps={...i.versionListElementProps,currentVersionIdentifier:n.versioningStateLookup.get(t).currentVersionInfo.versionIdentifier})}));break;case"deleteVersion":n.deleteVersion(t,s.versionIdentifier.name,s.versionIdentifier.guid).then((async e=>{e&&this.arcgisVersioningStateChanged.emit({type:"version-deleted",versionIdentifier:s.versionIdentifier,versioningState:n.versioningStateLookup.get(t)}),await this._refreshVersionList(t)}));break;case"editVersion":{const e=this._createVersionPropertiesFlowItem(t,s);o.value?.appendChild(e),this.versionList&&(this.versionList.selected=!1);break}}}async _refreshVersionList(e){const{flowElement:{value:i},versionList:t,viewModel:s}=this;if(i){const n=await s.getVersionInfos(e),o=i.getElementsByTagName("arcgis-version-management-service-item");for(const i of o)i.serviceItemElementProps.serviceUrl===e&&(i.serviceItemElementProps={...i.serviceItemElementProps,versionInfos:n});t&&(t.versionListElementProps={...t.versionListElementProps,currentVersionIdentifier:s.versioningStateLookup.get(e).currentVersionInfo.versionIdentifier,versionInfos:n})}}_removeVersionListFlowItem(e){for(const i of e.childNodes)"ARCGIS-VERSION-MANAGEMENT-VERSION-LIST"===i.nodeName.toUpperCase()&&(e.removeChild(i),this.versionList=void 0),"CALCITE-FLOW-ITEM"===i.nodeName.toUpperCase()&&(i.hidden=!1)}_removeVersionPropertiesFlowItem(e){for(const i of e.childNodes)"ARCGIS-VERSION-MANAGEMENT-VERSION-PROPERTIES"===i.nodeName.toUpperCase()&&e.removeChild(i)}render(){const{allowEditingDisabled:e,closable:i,flowElement:{value:t},initialVersionInfos:s,_isInitialVersionInvalid:o,label:r,messages:c,mode:d,pageSize:h,versionList:v,viewModel:g,viewModel:{loadError:m,state:u}}=this,f=Array.from(g.serviceNameLookup,(([e,i])=>({url:e,name:i}))),p="disabled"!==u?f.map((a=>{const l={allowEditing:!e,closable:i,currentUser:g.userLookup.get(a.url),currentVersionIdentifier:g.versioningStateLookup.get(a.url).currentVersionInfo.versionIdentifier,executionError:void 0,flowElement:t,hasAdvEditingUte:g.advancedEditingUserTypeExtensionLookup.get(a.url),heading:r,initialVersionInfos:s,isInitialVersionInvalid:o,isVersionAdministrator:g.versionAdministratorLookup.get(a.url),isVersioningApiAvailable:(g.serverVersionLookup.get(a.url)??0)>=11.2,mode:d,pageSize:h,serviceName:a.name,state:u,serviceUrl:a.url,strings:c,versionInfos:g.versioningStateLookup.get(a.url)?.versionInfos??[]};return n.qy`<arcgis-version-management-service-item .serviceItemElementProps=${l} @arcgisGetVersions=${async e=>{await this._refreshVersionList(e.detail.serviceUrl)}} @arcgisFlowItemBack=${()=>{t&&(this._removeVersionListFlowItem(t),this.versionList=void 0)}} @arcgisFlowItemClose=${()=>{this._handleFlowItemClose()}} @arcgisManageVersion=${this._handleManageVersionAction} @arcgisNewVersion=${this._handleNewVersionAction} @arcgisCreateVersionList=${e=>{this.versionList=e.detail}}></arcgis-version-management-service-item>`})):void 0,w="disabled"===u&&null!=m?n.qy`<calcite-notice class="notice" kind=warning open scale=s slot=footer width=full><div slot=message>${this._getLoadError(m)}</div></calcite-notice>`:void 0,I=this._showInvalidFeatureServiceNotice?n.qy`<calcite-notice closable kind=warning open scale=s slot=content-top width=full icon @calciteNoticeClose=${()=>this._showInvalidFeatureServiceNotice=!1}><div slot=title>${c.headers.invalidInitialFeatureService}</div><div slot=message>${c.loadErrors.invalidInitialFeatureService}</div></calcite-notice>`:void 0;return n.qy`<calcite-flow custom-item-selectors="arcgis-version-management-version-list, arcgis-version-management-version-properties" class=${(0,a.CP)("dialog"===this.mode?"":"calcite-flow-widget")} ${(0,l.K)(this.flowElement)}><calcite-flow-item .closable=${this.closable} .heading=${r??void 0} @calciteFlowItemClose=${()=>{this._handleFlowItemClose()}} .selected=${!v}>${I}<calcite-panel .loading=${"loading"===u||"executing"===u}>${p}${w}</calcite-panel></calcite-flow-item></calcite-flow>`}}(0,s.c)("arcgis-version-management",m)},396:(e,i,t)=>{t.d(i,{_:()=>g,K:()=>f});var s=t(6752),n=t(8504),o=t(7804);const r=(e,i)=>{const t=e._$AN;if(void 0===t)return!1;for(const e of t)e._$AO?.(i,!1),r(e,i);return!0},a=e=>{let i,t;do{if(void 0===(i=e._$AM))break;t=i._$AN,t.delete(e),e=i}while(0===t?.size)},l=e=>{for(let i;i=e._$AM;e=i){let t=i._$AN;if(void 0===t)i._$AN=t=new Set;else if(t.has(e))break;t.add(e),h(i)}};function c(e){void 0!==this._$AN?(a(this),this._$AM=e,l(this)):this._$AM=e}function d(e,i=!1,t=0){const s=this._$AH,n=this._$AN;if(void 0!==n&&0!==n.size)if(i)if(Array.isArray(s))for(let e=t;e<s.length;e++)r(s[e],!1),a(s[e]);else null!=s&&(r(s,!1),a(s));else r(this,e)}const h=e=>{e.type==o.OA.CHILD&&(e._$AP??=d,e._$AQ??=c)};class v extends o.WL{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,i,t){super._$AT(e,i,t),l(this),this.isConnected=e._$AU}_$AO(e,i=!0){e!==this.isConnected&&(this.isConnected=e,e?this.reconnected?.():this.disconnected?.()),i&&(r(this,e),a(this))}setValue(e){if((0,n.Rt)(this._$Ct))this._$Ct._$AI(e,this);else{const i=[...this._$Ct._$AH];i[this._$Ci]=e,this._$Ct._$AI(i,this,0)}}disconnected(){}reconnected(){}}const g=()=>new m;class m{}const u=new WeakMap,f=(0,o.u$)(class extends v{render(e){return s.s6}update(e,[i]){const t=i!==this.Y;return t&&void 0!==this.Y&&this.rt(void 0),(t||this.lt!==this.ct)&&(this.Y=i,this.ht=e.options?.host,this.rt(this.ct=e.element)),s.s6}rt(e){if(this.isConnected||(e=void 0),"function"==typeof this.Y){const i=this.ht??globalThis;let t=u.get(i);void 0===t&&(t=new WeakMap,u.set(i,t)),void 0!==t.get(this.Y)&&this.Y.call(this.ht,void 0),t.set(this.Y,e),void 0!==e&&this.Y.call(this.ht,e)}else this.Y.value=e}get lt(){return"function"==typeof this.Y?u.get(this.ht??globalThis)?.get(this.Y):this.Y?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}})}}]);