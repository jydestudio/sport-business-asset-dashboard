System.register(["jimu-core"],(function(e,t){var a={};return{setters:[function(e){a.AbstractDataAction=e.AbstractDataAction,a.DataLevel=e.DataLevel,a.DataSourceStatus=e.DataSourceStatus,a.DataSourceTypes=e.DataSourceTypes,a.MutableStoreManager=e.MutableStoreManager,a.appActions=e.appActions,a.getAppStore=e.getAppStore,a.utils=e.utils}],execute:function(){e((()=>{var e={79244:e=>{"use strict";e.exports=a}},t={};function o(a){var r=t[a];if(void 0!==r)return r.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,o),n.exports}o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var r={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(r),o.d(r,{default:()=>d});var e,t,a,n,i,s,u=o(79244);!function(e){e.Layer="LAYER",e.Map="MAP"}(e||(e={})),function(e){e.Dropdown="DROPDOWN",e.Tabs="TABS"}(t||(t={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE"}(a||(a={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(n||(n={})),function(e){e.Fit="FIT",e.Fixed="FIXED"}(i||(i={})),function(e){e.View="VIEW",e.Add="ADD"}(s||(s={}));const c=[u.DataSourceTypes.FeatureLayer,u.DataSourceTypes.SceneLayer,u.DataSourceTypes.BuildingComponentSubLayer,u.DataSourceTypes.OrientedImageryLayer,u.DataSourceTypes.ImageryLayer],l=[u.DataSourceTypes.SubtypeGroupLayer,u.DataSourceTypes.ImageryTileLayer,u.DataSourceTypes.ElevationLayer];class d extends u.AbstractDataAction{constructor(){super(...arguments),this.deepClone=e=>{const t=Array.isArray(e)?[]:{};for(const a in e){const o=("object"==typeof e[a]||"function"==typeof e[a])&&null!==e[a];t[a]=o?this.deepClone(e[a]):e[a]}return t}}isSupported(e,t){if(e.length>1)return Promise.resolve(!1);let a=!0;const o=e[0],{dataSource:r}=o;if(!Object.keys(r.getSchema()||{}).length)return Promise.resolve(!1);const n=c.includes(r.type),i=r.isDataSourceSet(),s=t!==u.DataLevel.DataSource,d=!r.isInAppConfig()&&!n,p=l.includes(r.type);return(i||s||d||p)&&(a=!1),Promise.resolve(a&&r.getStatus()!==u.DataSourceStatus.NotReady)}onExecute(e,t){var o,r,i,c;const l=t===u.DataLevel.DataSource,d=e[0],{dataSource:p}=d,S=p&&p.getSchema(),b=!p.isInAppConfig(),y=["CreationDate","Creator","EditDate","Editor","GlobalID"],g=Object.values(null==S?void 0:S.fields),D=g.filter((e=>!y.includes(e.jimuName))).map((e=>Object.assign(Object.assign({},e),{visible:!0}))),v=`DaTable-${u.utils.getUUID()}`,f=(l?"":d.name)||p.getLabel()||(null===(o=p.getDataSourceJson())||void 0===o?void 0:o.sourceLabel),A={dataSourceId:p.id,mainDataSourceId:null===(r=p.getMainDataSource())||void 0===r?void 0:r.id,dataViewId:p.dataViewId,rootDataSourceId:null===(i=p.getRootDataSource())||void 0===i?void 0:i.id},m=Object.assign({id:v,name:f,allFields:g,tableFields:D,enableAttachments:!1,enableEdit:!1,allowCsv:!1,showCount:!0,enableSearch:!1,searchFields:[],enableRefresh:!1,enableSelect:!0,enableDelete:!1,selectMode:a.Multiple,layerHonorMode:n.Webmap,dataActionObject:!0,dataActionType:s.Add},b?{dataActionDataSource:p}:{useDataSource:A}),I=(null===(c=u.MutableStoreManager.getInstance().getStateValue([this.widgetId]))||void 0===c?void 0:c.viewInTableObj)||{};return I[v]={daLayerItem:m},u.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"viewInTableObj",I),(0,u.getAppStore)().dispatch(u.appActions.widgetStatePropChange(this.widgetId,"dataActionActiveObj",{activeTabId:v,dataActionTable:!0})),Promise.resolve(!0)}}})(),r})())}}}));