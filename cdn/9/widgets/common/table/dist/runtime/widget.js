System.register(["jimu-core","jimu-theme","jimu-ui","jimu-core/react","esri/widgets/FeatureTable/support/TableTemplate","esri/core/reactiveUtils","esri/widgets/FeatureTable","jimu-arcgis","jimu-layouts/layout-runtime","esri/geometry/geometryEngine","esri/geometry/Polygon"],(function(e,t){var n={},a={},l={},o={},i={},s={},r={},c={},d={},u={},p={};return{setters:[function(e){n.AppMode=e.AppMode,n.BaseVersionManager=e.BaseVersionManager,n.CONSTANTS=e.CONSTANTS,n.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,n.DataSourceComponent=e.DataSourceComponent,n.DataSourceManager=e.DataSourceManager,n.DataSourceStatus=e.DataSourceStatus,n.DataSourceTypes=e.DataSourceTypes,n.Immutable=e.Immutable,n.JSAPILayerTypes=e.JSAPILayerTypes,n.MessageManager=e.MessageManager,n.MutableStoreManager=e.MutableStoreManager,n.QueryScope=e.QueryScope,n.React=e.React,n.ReactRedux=e.ReactRedux,n.ReactResizeDetector=e.ReactResizeDetector,n.ServiceManager=e.ServiceManager,n.SessionManager=e.SessionManager,n.WidgetState=e.WidgetState,n.appActions=e.appActions,n.appConfigUtils=e.appConfigUtils,n.classNames=e.classNames,n.css=e.css,n.dataSourceUtils=e.dataSourceUtils,n.defaultMessages=e.defaultMessages,n.esri=e.esri,n.getAppStore=e.getAppStore,n.hooks=e.hooks,n.jsx=e.jsx,n.lodash=e.lodash,n.polished=e.polished,n.privilegeUtils=e.privilegeUtils,n.useIntl=e.useIntl},function(e){a.Global=e.Global,a.useTheme=e.useTheme},function(e){l.AdvancedSelect=e.AdvancedSelect,l.Alert=e.Alert,l.Button=e.Button,l.DataActionList=e.DataActionList,l.DataActionListStyle=e.DataActionListStyle,l.Dropdown=e.Dropdown,l.DropdownButton=e.DropdownButton,l.DropdownItem=e.DropdownItem,l.DropdownMenu=e.DropdownMenu,l.Popper=e.Popper,l.Select=e.Select,l.Tab=e.Tab,l.Tabs=e.Tabs,l.TextInput=e.TextInput,l.Tooltip=e.Tooltip,l.WidgetPlaceholder=e.WidgetPlaceholder,l.defaultMessages=e.defaultMessages},function(e){o.Fragment=e.Fragment,o.useEffect=e.useEffect},function(e){i.default=e.default},function(e){s.watch=e.watch},function(e){r.default=e.default},function(e){c.JimuMapViewComponent=e.JimuMapViewComponent},function(e){d.LayoutItemSizeModes=e.LayoutItemSizeModes},function(e){u.buffer=e.buffer,u.geodesicBuffer=e.geodesicBuffer},function(e){p.default=e.default}],execute:function(){e((()=>{var e={59374:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M2 1h16a1 1 0 0 1 1 1v5H1V2a1 1 0 0 1 1-1m11 7H7v3h6zm0 4H7v3h6zm1 3v-3h5v3zm-1 1H7v3h6zm1 3h4a1 1 0 0 0 1-1v-2h-5zm0-8V8h5v3zM1 8h5v3H1zm0 4h5v3H1zm0 4h5v3H2a1 1 0 0 1-1-1zM0 2a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2z" clip-rule="evenodd"></path></svg>'},4280:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 400 400"><path fill="#000" d="M0 0h400v40H0z"></path><path fill="#000" fill-rule="evenodd" d="M80 55H20v9h60zm100 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 135h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 215h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 295h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 95h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 175h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 255h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 334h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 374h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60z" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M0 39h1v40h98V39h1v40h99V39h1v40h99V39h1v40h99V39h1v360h-1v-40h-99v40h99v1H0V39m1 320v40h98v-40zm98-1H1v-39h98zm1 1v40h99v-40zm99-1h-99v-39h99zm1 1v40h99v-40zm99-1h-99v-39h99zm1 0h99v-39h-99zM1 318v-38h98v38zm99 0v-38h99v38zm0-39h99v-39h-99zm100 39v-38h99v38zm0-39h99v-39h-99zm100 39v-38h99v38zm0-39h99v-39h-99zM1 279h98v-39H1zm0-79v39h98v-39zm98-1H1v-39h98zm1 1v39h99v-39zm99-1h-99v-39h99zm1 1v39h99v-39zm99-1h-99v-39h99zm1 1v39h99v-39zm99-1h-99v-39h99zM1 159v-39h98v39zm99 0v-39h99v39zm0-40h99V80h-99zm100 40v-39h99v39zm0-40h99V80h-99zm100 40v-39h99v39zm0-40h99V80h-99zM1 119h98V80H1z" clip-rule="evenodd"></path></svg>'},4651:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2m5 1a1 1 0 1 1 2 0 1 1 0 0 1-2 0m6 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0" clip-rule="evenodd"></path></svg>'},96300:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.52.52 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.51.51 0 0 1-.73 0L1 7.5l4.743-4.846a.51.51 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'},4583:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path fill="#000" fill-rule="evenodd" d="M0 12v-1.5h1V12h1.5v1H1a1 1 0 0 1-1-1M1 1h1.5v1H1v1.5H0V2a1 1 0 0 1 1-1m0 7.5H0v-3h1zM4.5 2V1h3v1zm5 0V1H11a1 1 0 0 1 1 1v1.5h-1V2zm4.813 14.02-3.535-3.535-3.536 3.535-.707-.707 3.536-3.535-3.536-3.536.707-.707 3.536 3.536 3.535-3.536.707.707-3.535 3.536 3.535 3.535z" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},49419:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M16 0H0v1h16z"></path><path fill="#000" fill-rule="evenodd" d="M5 11a3 3 0 1 0 6 0 3 3 0 0 0-6 0m3 2a2 2 0 1 0 0-4 2 2 0 0 0 0 4" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M8 6q3.874 0 7.75 4.349a.97.97 0 0 1 0 1.302Q11.874 16.001 8 16T.25 11.651a.97.97 0 0 1 0-1.302Q4.126 5.999 8 6m0 1c-2.237 0-4.558 1.303-6.961 4 2.403 2.698 4.724 4 6.96 4 2.238 0 4.559-1.303 6.962-4C12.558 8.303 10.237 7 8 7" clip-rule="evenodd"></path><path fill="#000" d="M0 3h13v1H0zM3 6H0v1h3z"></path></svg>'},7835:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M.438 1C.196 1 0 1.224 0 1.5s.196.5.438.5h15.125c.241 0 .437-.224.437-.5s-.196-.5-.437-.5zM0 7.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 8 0 7.776 0 7.5M0 13.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 14 0 13.776 0 13.5"></path></svg>'},21935:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.986 1a6.99 6.99 0 0 1 5.723 2.969l-2.551-.938a.5.5 0 1 0-.345.938l4.228 1.555.163-.944.013-.005-.009-.019.6-3.471a.5.5 0 1 0-.985-.17l-.403 2.33A8 8 0 0 0 0 7.5c-.016.277.21.501.486.501a.53.53 0 0 0 .517-.5A7 7 0 0 1 7.986 1M8.015 15a6.99 6.99 0 0 1-5.724-2.969l2.551.938a.497.497 0 0 0 .642-.296.5.5 0 0 0-.297-.642L.96 10.476l-.163.944-.013.005.009.019-.6 3.471a.5.5 0 1 0 .985.17l.403-2.33A8 8 0 0 0 16 8.5a.477.477 0 0 0-.485-.501.53.53 0 0 0-.518.5A7 7 0 0 1 8.015 15"></path></svg>'},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},20904:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M15.88 2.825a.5.5 0 0 0-.759-.65l-2.323 2.71-1.265-1.265a.5.5 0 1 0-.707.707l1.265 1.265a1 1 0 0 0 1.466-.056zm0 8a.5.5 0 0 0-.759-.65l-2.323 2.71-1.265-1.265a.5.5 0 1 0-.707.708l1.265 1.264a1 1 0 0 0 1.466-.056zM9 4.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M8.5 13a.5.5 0 0 0 0-1h-8a.5.5 0 0 0 0 1z" clip-rule="evenodd"></path></svg>'},27964:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 4.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M16 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M5.146 2.12a.5.5 0 0 1 .055.705l-2.324 2.71a1 1 0 0 1-1.466.057L.146 4.327a.5.5 0 0 1 .708-.707l1.264 1.265 2.323-2.71a.5.5 0 0 1 .705-.055M5.146 10.12a.5.5 0 0 1 .055.705l-2.324 2.71a1 1 0 0 1-1.466.057L.146 12.328a.5.5 0 1 1 .708-.708l1.264 1.265 2.323-2.71a.5.5 0 0 1 .705-.055" clip-rule="evenodd"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},65959:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13 1v1.5h-.058L7.944 7.689v7.821c0 .27-.207.49-.464.49a.45.45 0 0 1-.325-.14l-2.1-2.18V7.681L.066 2.5H0V1zm-.929.98H.93v.041l5.055 5.25v5.998l1.031 1.071V7.278l5.056-5.25z" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M10.359 14.118 9 14.878v-1.146l.75-.42v-3.52l-.75.42V9.066l1.402-.785 2.049 1.331L15.25 8v5.825l-2.906 1.626zM10.75 9.7v3.476l1.25.84v-3.504zm2.25.75 1.25-.72v3.508l-1.25.7z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},62243:e=>{"use strict";e.exports=s},31526:e=>{"use strict";e.exports=p},77958:e=>{"use strict";e.exports=u},92799:e=>{"use strict";e.exports=r},71758:e=>{"use strict";e.exports=i},62686:e=>{"use strict";e.exports=c},79244:e=>{"use strict";e.exports=n},68972:e=>{"use strict";e.exports=o},41496:e=>{"use strict";e.exports=d},1888:e=>{"use strict";e.exports=a},14321:e=>{"use strict";e.exports=l}},t={};function v(n){var a=t[n];if(void 0!==a)return a.exports;var l=t[n]={exports:{}};return e[n](l,l.exports,v),l.exports}v.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return v.d(t,{a:t}),t},v.d=(e,t)=>{for(var n in t)v.o(t,n)&&!v.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},v.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),v.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},v.p="";var h={};return v.p=window.jimuConfig.baseUrl,(()=>{"use strict";v.r(h),v.d(h,{__set_webpack_public_path__:()=>yt,default:()=>bt});var e,t,n,a,l,o,i=v(79244);!function(e){e.Layer="LAYER",e.Map="MAP"}(e||(e={})),function(e){e.Dropdown="DROPDOWN",e.Tabs="TABS"}(t||(t={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE"}(n||(n={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(a||(a={})),function(e){e.Fit="FIT",e.Fixed="FIXED"}(l||(l={})),function(e){e.View="VIEW",e.Add="ADD"}(o||(o={}));class s extends i.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.6.0",description:"Add editable to table fields.",upgrader:(e,t)=>{let n=e;return 0===n.layersConfig.length||n.layersConfig.forEach(((e,t)=>{const a=e.tableFields.map((e=>Object.assign(Object.assign({},e),{editAuthority:!0})));n=n.setIn(["layersConfig",t,"tableFields"],a)})),n}},{version:"1.10.0",description:"Add visible to table fields.",upgrader:e=>{let t=e;return 0===t.layersConfig.length||t.layersConfig.forEach(((e,n)=>{const a=e.tableFields.map((e=>Object.assign(Object.assign({},e),{visible:!0})));t=t.setIn(["layersConfig",n,"tableFields"],a)})),t}},{version:"1.12.0",description:"Add header setting options.",upgrader:e=>{let t=e;return 0===t.layersConfig.length||t.layersConfig.forEach(((e,n)=>{e=e.set("headerFontSetting",{backgroundColor:"",fontSize:14,bold:!1,color:""}),t=t.setIn(["layersConfig",n],e)})),t}},{version:"1.13.0",description:'Add "showCount" and "updateText" options.',upgrader:e=>{let t=e;return 0===t.layersConfig.length||t.layersConfig.forEach(((e,n)=>{if(e=e.set("showCount",!1).set("updateText",!0),t=t.setIn(["layersConfig",n],e),(null==e?void 0:e.searchFields)&&"string"==typeof(null==e?void 0:e.searchFields)){const a=e.searchFields.split(",")||[];t=t.setIn(["layersConfig",n,"searchFields"],a)}else(null==e?void 0:e.searchFields)||(t=t.setIn(["layersConfig",n,"searchFields"],[]))})),t}},{version:"1.14.0",description:"Update honor webmap options",upgrader:e=>{let t=e;const n=t.layersConfig.map((e=>Object.assign(Object.assign({},e),{layerHonorMode:a.Custom})));return t=t.setIn(["layersConfig"],n),t}},{version:"1.15.0",description:"Update column setting",upgrader:e=>{let t=e;const n=t.layersConfig.map((e=>Object.assign(Object.assign({},e),{columnSetting:{responsiveType:l.Fixed,columnWidth:200}})));return t=t.setIn(["layersConfig"],n),t}},{version:"1.16.0",description:"Modify a property spelling error",upgrader:t=>{let n=t;const a=n.layersConfig.map((e=>{const t=e.enableAttachements,n=Object.assign(Object.assign({},e),{enableAttachments:t});return delete n.enableAttachements,n}));return n=n.setIn(["layersConfig"],a).setIn(["tableMode"],e.Layer),n}}]}}const r=new s;var c=v(1888),d=v(62838),u=v.n(d),p=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(n[a[l]]=e[a[l]])}return n};const m=e=>{const t=window.SVG,{className:n}=e,a=p(e,["className"]),l=(0,i.classNames)("jimu-icon jimu-icon-component",n);return t?i.React.createElement(t,Object.assign({className:l,src:u()},a)):i.React.createElement("svg",Object.assign({className:l},a))};var g=v(14321);const f=e=>{const{allLayersConfig:t,isHorizontalTab:n,activeTabId:a,searchOn:l,toolListNode:o,onTabClick:s,onCloseTab:r}=e;return(0,i.jsx)("div",{className:"d-flex table-tab-select "+(n?"horizontal-tab-select":"dropdown-tab-select"),css:i.css`
  &.table-tab-select{
    .horizontal-tab-select{
      margin-bottom: 4px;
      .activeBtn{
        color: #fff;
        background-color: #076fe5;
      }
    }
    .dropdown-tab-select{
      height: 40px;
      margin-bottom: 4px;
      .dropdown-button{
        height: 32px;
      }
    }
    .tab-flex{
      width: 100%;
      overflow-x: auto;
      .closeable{
        height: 31px;
      }
    }
  }
`},n?(0,i.jsx)(g.Tabs,{scrollable:!0,type:"underline",className:"tab-flex",value:a,onChange:s,onClose:r},t.map((e=>{const t=!!e.dataActionObject;return(0,i.jsx)(g.Tab,{key:e.id,id:e.id,title:e.name,className:"text-truncate",closeable:t},(0,i.jsx)("div",{className:"mt-2"}))}))):(0,i.jsx)(g.Select,{size:"sm",value:a,onChange:e=>{var t;s(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value)},className:"top-drop"},t.map((e=>(0,i.jsx)("option",{key:e.id,value:e.id,title:e.name},(0,i.jsx)("div",{className:"table-action-option"},(0,i.jsx)("div",{className:"table-action-option-tab",title:e.name},e.name),e.dataActionObject&&(0,i.jsx)("div",{className:"table-action-option-close"},(0,i.jsx)(g.Button,{size:"sm",icon:!0,type:"tertiary",onClick:t=>{r(e.id,t)}},(0,i.jsx)(m,{size:"s"})))))))),!l&&o)};var b=v(50170),y=v.n(b),w=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(n[a[l]]=e[a[l]])}return n};const S=e=>{const t=window.SVG,{className:n}=e,a=w(e,["className"]),l=(0,i.classNames)("jimu-icon jimu-icon-component",n);return t?i.React.createElement(t,Object.assign({className:l,src:y()},a)):i.React.createElement("svg",Object.assign({className:l},a))};var x=v(96300),j=v.n(x),R=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(n[a[l]]=e[a[l]])}return n};const O=e=>{const t=window.SVG,{className:n}=e,a=R(e,["className"]),l=(0,i.classNames)("jimu-icon jimu-icon-component",n);return t?i.React.createElement(t,Object.assign({className:l,src:j()},a)):i.React.createElement("svg",Object.assign({className:l},a))},I=e=>i.css`
  &.table-search-div{
    .table-search{
      .search-icon{
        z-index: 2;
      }
      .search-input{
        border: 1px solid ${e.ref.palette.neutral[500]};
        border-radius: 2px;
        .input-wrapper{
          height: 30px;
          border: none;
        }
      }
    }
  }
`,T=e=>{const{searchToolTowed:t,hint:n,tableLoaded:a,searchText:l,handleSearchChange:o,closeSuggestionAndSearch:s}=e,[r,d]=i.React.useState(!1),u=i.React.useRef(),p=i.hooks.useTranslation(i.defaultMessages),v=(0,c.useTheme)(),h=n||p("search"),m=e=>{e&&e.target&&"Enter"===e.key&&s()},f=()=>(0,i.jsx)(g.Button,{type:"tertiary",icon:!0,size:"sm",onClick:s,className:"search-icon"},(0,i.jsx)(S,{color:v.ref.palette.neutral[700]}));return(0,i.jsx)("div",{className:"table-search-div",css:I(v)},t?(0,i.jsx)("div",{className:"float-right",ref:u},(0,i.jsx)(g.Button,{type:"tertiary",icon:!0,size:"sm",className:"tools-menu",title:p("search"),onClick:e=>{d(!r)}},(0,i.jsx)(S,null)),(0,i.jsx)(g.Popper,{placement:"right-start",reference:u.current,offsetOptions:[-10,-30],open:r,arrowOptions:!1,toggle:e=>{d(!r)}},(0,i.jsx)("div",{className:"d-flex align-items-center table-popup-search m-2"},(0,i.jsx)(g.Button,{type:"tertiary",icon:!0,size:"sm",onClick:e=>{d(!1)},className:"search-back mr-1"},(0,i.jsx)(O,{color:v.ref.palette.neutral[1100]})),(0,i.jsx)(g.TextInput,{className:"popup-search-input",placeholder:h,onChange:e=>{o(e.target.value)},value:l||"",onKeyDown:e=>{m(e)},prefix:f(),allowClear:!0,title:h,disabled:!a})))):(0,i.jsx)("div",{className:"d-flex align-items-center table-search"},(0,i.jsx)(g.TextInput,{className:"search-input",placeholder:h,onChange:e=>{o(e.target.value)},value:l||"",onKeyDown:e=>{m(e)},prefix:f(),allowClear:!0,title:h,disabled:!a})))};function C(e,t,n,a){const{id:l,isHeightAuto:o,isWidthAuto:s,headerFontSetting:r,widgetWidth:c}=a;return i.css`
    ${"&.table-widget-"+l} {
      .hide-table{
        display: none;
      }
      .table-indent{
        width: calc(100% - 32px);
        height: calc(100% - 26px);
        margin: 10px 16px 16px;
        display: inline-block;
        ${o&&"min-height: 190px;"};
        ${s&&"min-width: 360px;"};
        .horizontal-action-dropdown{
          button{
            width: 32px;
            height: 32px;
          }
        }
        .tool-dividing-line{
          height: 16px;
          width: 1px;
          display: inline-flex;
          background-color: ${e.ref.palette.neutral[500]};
          margin: 8px 4px;
        }
        .data-action-btn{
          position: relative;
        }
      }
      .tab-title{
        user-select: none;
        margin: auto;
      }
      .tab-flex{
        width: 100%;
        overflow-x: auto;
        .closeable{
          height: 31px;
        }
      }
      .top-drop{
        width: 30%;
        min-width: 150px;
        button{
          line-height: 1.5;
        }
      }
      .nav-underline{
        height: 32px;
        border-bottom: 1px solid ${e.ref.palette.neutral[400]};
        .nav-item{
          height: 31px;
          max-width: calc(${c/2}px - ${t?"40px":"120px"});
        }
      }
      .nav-item + .nav-item{
        margin-left: 0;
      }
      .csv-dropdown-con{
        button{
          border-radius: 13px;
        }
      }
      .vertical-tab-select{
        width: 20%;
        display: inline-block;
        .tagBtn{
          width: 100%;
        }
      }
      .horizontal-tab-select{
        .tagBtn{
          width: 150px;
        }
        .tab-content{
          height: 8px;
        }
      }
      .vertical-tab-select,
      .horizontal-tab-select{
        margin-bottom: 4px;
        .activeBtn{
          color: #fff;
          background-color: #076fe5;
        }
      }
      .dropdown-tab-select{
        height: 40px;
        margin-bottom: 4px;
        .dropdown-button{
          height: 32px;
        }
      }
      .vertical-render-con{
        width: 80%;
        position: absolute;
        left: 20%;
        height: 100%;
        top: 0;
      }
      .dropdown-render-con,
      .horizontal-render-con{
        width: 100%;
        height: calc(100% - 45px);
      }
      .mobile-map-button{
        display: inline-flex;
        button{
          width: 32px;
          height: 32px;
        }
      }
      .table-header{
        height: ${n?"40px":"0"};
        width: 100%;
        display: flex;
        justify-content: space-between;
      }
      .table-con{
        width: 100%;
        height: ${n?"calc(100% - 40px);":"100%"};
        .esri-widget{
          background-color: transparent;
          vaadin-grid-cell-content:has(.esri-column__header-content) {
            ${(null==r?void 0:r.backgroundColor)&&`background-color: ${r.backgroundColor};`}
            ${(null==r?void 0:r.fontSize)&&`font-size: ${r.fontSize}px;`}
            ${(null==r?void 0:r.bold)&&"font-weight: bold;"}
            ${(null==r?void 0:r.color)&&`color: ${r.color};`}
            ${function(e){const t=[];e&&(e.backgroundColor&&(t.push(`--calcite-color-foreground-1: ${e.backgroundColor};`),t.push("--calcite-color-foreground-2: #0000000a;"),t.push("--calcite-color-foreground-3: #0000000a;")),e.color&&(t.push(`--calcite-color-text-3: ${e.color};`),t.push(`--calcite-color-text-1: ${e.color};`)),e.fontSize&&t.push(`--calcite-font-size--2: ${e.fontSize};`),e.bold&&t.push("--calcite-ui-text-3: bold;"));return t.join(" ")}(r)}
            .esri-column__header-content {
              ${(null==r?void 0:r.bold)&&"font-weight: bold;"}
            }
          }
        }
        .esri-grid .esri-column__sorter{
          overflow-x: auto;
          overflow-y: hidden;
        }
        .esri-field-column__header-content{
          width: calc(100% - 26px);
          overflow: unset;
        }
        .esri-feature-table__loader-container{
          position: absolute;
          left: 50%;
          top: 50%;
          margin-left: -16px;
          margin-top: -20px;
          z-index: 2;
        }
        .esri-feature-table__content{
          min-height: 145px;
        }
      }
      .table-bottom-info {
        position: absolute;
        width: 100%;
        left: 0;
        bottom: 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .adv-select-con{
        width: 200px;
        visibility: hidden;
        position: absolute;
        right: 17px;
        top: 56px;
      }
      .ds-container{
        position: absolute;
        display: none;
      }
      .dropdown-button-content{
        .table-action-option-close{
          display: none;
        }
      }
    }
  `}var E=v(68972);const D=["CreationDate","Creator","EditDate","Editor","GlobalID"],N=((0,i.Immutable)([i.DataSourceTypes.FeatureLayer,i.DataSourceTypes.SceneLayer,i.DataSourceTypes.BuildingComponentSubLayer,i.DataSourceTypes.OrientedImageryLayer,i.DataSourceTypes.ImageryLayer,i.DataSourceTypes.SubtypeSublayer]),(0,i.Immutable)([i.DataSourceTypes.WebMap,i.DataSourceTypes.WebScene,i.DataSourceTypes.MapService,i.DataSourceTypes.FeatureService,i.DataSourceTypes.SceneService,i.DataSourceTypes.GroupLayer,i.DataSourceTypes.BuildingGroupSubLayer,i.DataSourceTypes.BuildingSceneLayer,i.DataSourceTypes.SubtypeGroupLayer]),[i.JSAPILayerTypes.FeatureLayer,i.JSAPILayerTypes.SceneLayer,i.JSAPILayerTypes.BuildingComponentSublayer,i.JSAPILayerTypes.OrientedImageryLayer,i.JSAPILayerTypes.ImageryLayer,i.JSAPILayerTypes.SubtypeSublayer]);function M(e){if(!e||!e.type)return!1;const t=e.type,n=t!==i.JSAPILayerTypes.BuildingComponentSublayer||t===i.JSAPILayerTypes.BuildingComponentSublayer&&e.view,a=N.includes(t);return n&&a}const A=e=>i.DataSourceManager.getInstance().getDataSource(e);function z(e,t,n){const a=n||"jimuName",l=e.length>t.length,o=l?t:e;return(l?e:t).filter((e=>!o.some((t=>(null==t?void 0:t[a])===(null==e?void 0:e[a])))))}var L=v(71758),F=function(e,t,n,a){return new(n||(n=Promise))((function(l,o){function i(e){try{r(a.next(e))}catch(e){o(e)}}function s(e){try{r(a.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?l(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}r((a=a.apply(e,t||[])).next())}))};const P=i.DataSourceManager.getInstance();function _(e){return i.dataSourceUtils.getTimezoneAPIFromRuntime(e.getTimezone())}const V=(e,t)=>{const n=((null==e?void 0:e.fields)||[]).find((e=>e.name===t));return!n||(null==n?void 0:n.editable)},k=(e,t,n)=>{var o,i,s;const r=null==e?void 0:e.getSchema(),c=(null==r?void 0:r.fields)?Object.values(null==r?void 0:r.fields):[],d=null==e?void 0:e.getLayerDefinition(),u=t.columnSetting,p=(null==u?void 0:u.responsiveType)===l.Fit?{autoWidth:!0}:{autoWidth:!1,width:(null==u?void 0:u.columnWidth)||200},v=z(c,n?n.map((e=>({jimuName:e.value}))):t.tableFields.filter((e=>e.visible))).map((e=>e.jimuName)),h=null==e?void 0:e.getCurrentQueryParams(),m=(null==h?void 0:h.orderByFields)||[],g={};let f;m.forEach(((e,t)=>{var n;const a=e.split(" ");g[a[0]]={direction:null===(n=a[1])||void 0===n?void 0:n.toLowerCase(),initialSortPriority:t}}));const b=(null===(o=null==d?void 0:d.fields)||void 0===o?void 0:o.length)>0?d.fields:c,y=t.layerHonorMode===a.Webmap;if(y){const t=null===(i=null==e?void 0:e.getPopupInfo)||void 0===i?void 0:i.call(e),n=(null==t?void 0:t.fieldInfos)||[],a=Object.keys((null==r?void 0:r.fields)||{}),l=n.filter((e=>a.includes(e.fieldName)&&!D.includes(e.fieldName))),o=((e,t)=>{let n=[];const a=Object.keys(e||{});return(null==t?void 0:t.length)>=(null==a?void 0:a.length)?n=t.filter((e=>a.includes(e.jimuName||e.name))):a.forEach((a=>{const l=e[a],o=t.find((e=>e.name===a));n.push(Object.assign(Object.assign({},l),o))})),n=n.filter((e=>!D.includes(e.name))),n})(null==r?void 0:r.fields,b);f=(null===(s=null==t?void 0:t.fieldInfos)||void 0===s?void 0:s.length)>0?new L.default({columnTemplates:l.map((e=>{var t;const n=e.fieldName;return Object.assign(Object.assign(Object.assign(Object.assign({},e),p),{type:"field",editable:null!==(t=e.isEditable)&&void 0!==t&&t}),g[n]?g[n]:{})}))}):new L.default({columnTemplates:o.map((e=>{const t=e.jimuName||e.name;return Object.assign(Object.assign(Object.assign(Object.assign({},e),p),{type:"field",fieldName:t,label:e.alias||e.name,editable:V(d,t),visible:!0}),g[t]?g[t]:{})}))})}else y||(f=new L.default({columnTemplates:t.tableFields.map((e=>{var t;const n=e.jimuName||e.name,a=null===(t=null==r?void 0:r.fields)||void 0===t?void 0:t[n];return Object.assign(Object.assign(Object.assign({type:"field"},p),{fieldName:n,label:null==a?void 0:a.alias,editable:V(d,n)&&(null==e?void 0:e.editAuthority),visible:v.indexOf(n)<0}),g[n]?g[n]:{})}))}));return f},B=(e,t,o,s)=>{var r,c,d;const u=e.getSchema(),p=null==e?void 0:e.getLayerDefinition(),v=(null==u?void 0:u.fields)?Object.values(null==u?void 0:u.fields):[],h=(null==p?void 0:p.fields)||[];let m=v.filter((e=>!D.includes(e.jimuName))).map((e=>{const t=h.find((t=>t.name===e.jimuName)),n=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:n,editable:n,visible:!0})}));const g=null===(r=null==e?void 0:e.getPopupInfo())||void 0===r?void 0:r.fieldInfos;if("output"!==e.dataViewId&&g&&(null==g?void 0:g.length)>0){const e=[];g.forEach((t=>{(null==t?void 0:t.visible)&&e.push(t.fieldName)})),m=m.filter((t=>e.includes(t.name)))}(null==m?void 0:m.length)>50&&(m=m.slice(0,50));const f={dataSourceId:e.id,mainDataSourceId:null===(c=e.getMainDataSource())||void 0===c?void 0:c.id,dataViewId:e.dataViewId,rootDataSourceId:null===(d=e.getRootDataSource())||void 0===d?void 0:d.id},b=(0,i.Immutable)(f),y=m.map((e=>e.jimuName)),w=b.set("fields",y);return{id:t?e.id:o?o(e.id):e.id,name:e.getLabel(),useDataSource:w.asMutable({deep:!0}),allFields:v,tableFields:m,enableAttachments:!1,enableEdit:!1,allowCsv:!1,enableSearch:!1,searchFields:[],enableRefresh:!0,enableSelect:!0,enableDelete:!1,selectMode:n.Single,showCount:!0,headerFontSetting:{backgroundColor:"",fontSize:14,bold:!1,color:""},columnSetting:{responsiveType:l.Fixed,columnWidth:200},layerHonorMode:a.Webmap,parentViewId:s}},H=e=>{const{searchToolTowed:t,curLayerConfig:n,dataSource:a,tableLoaded:l,widgetState:o,toolListNode:s,handleSubmit:r}=e,[c,d]=i.React.useState(),[u,p]=i.React.useState(!1),[v,h]=i.React.useState([]),m=i.React.useRef(null),f=i.React.useRef(),b=i.ReactRedux.useSelector((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode})),y=i.ReactRedux.useSelector((e=>{var t;return null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.currentPageId})),w=new(0,i.esri.Sanitizer),S=i.React.useCallback((()=>{if((null==c?void 0:c.length)<3)return!1;(function(e,t,n){return F(this,void 0,void 0,(function*(){const a={searchText:e,searchFields:(null==t?void 0:t.searchFields)||[],dataSource:n,exact:null==t?void 0:t.searchExact};return i.dataSourceUtils.querySuggestions(a)}))})(c,n,a).then((e=>{h(e)}))}),[c,n,a]);(0,E.useEffect)((()=>(c?(clearTimeout(f.current),f.current=setTimeout((()=>{S()}),200)):r(""),()=>{clearTimeout(f.current)})),[c,u,r,S]),(0,E.useEffect)((()=>{const e=o===i.WidgetState.Closed,t=b===i.AppMode.Design;(e||t)&&(d(""),p(!1))}),[o,b]),(0,E.useEffect)((()=>{d(""),p(!1)}),[y]);return(0,i.jsx)("div",{className:"table-header",ref:m,css:i.css`
  &.table-header{
    height: 40px;
    width: 100%;
    display: flex;
    justify-content: space-between;
  }
`},(0,i.jsx)(T,{searchToolTowed:t,hint:null==n?void 0:n.searchHint,tableLoaded:l,searchText:c,handleSearchChange:e=>{e?(d(e),p((null==e?void 0:e.length)>2)):(d(e),p(!1),h([]))},closeSuggestionAndSearch:()=>{p(!1),r(c)}}),(0,i.jsx)(g.Popper,{css:i.css`
    & {
      max-height: ${i.polished.rem(300)};
      min-width: ${i.polished.rem(200)};
      overflow: auto;
    }
    button {
      display: block;
      width: 100%;
      text-align: left;
      border: none;
      border-radius: 0;
    }
    button:hover {
      border: none;
    }
  `,placement:"bottom-start",reference:m,offsetOptions:[0,-2],open:u,trapFocus:!1,autoFocus:!1,toggle:()=>{p(!u)}},v.map(((e,t)=>{const n=w.sanitize(e.suggestionHtml);return(0,i.jsx)(g.Button,{key:t,type:"secondary",size:"sm",onClick:()=>{(e=>{d(e),p(!1),r(e)})(e.suggestion)}},(0,i.jsx)("div",{className:"w-100",dangerouslySetInnerHTML:{__html:n}}))}))),s)},U={_widgetLabel:"Table",_widgetDescription:"This is an interactive table widget",showAllRecords:"Show all records",showHideCols:"Show/hide columns",toggleSelect:"Show selection/all",_action_viewInTable_label:"View in table",tableDataActionLabel:"{layer} table selection",tableCount:"Total: {total} | Selection: {selected}",_action_addToTable_label:"Add to table",deleteRecords:"Delete selection",enableMapExtentFilter:"Filter by the connected map extent"},G=e=>i.css`
    &.placeholder-table-con{
      height: ${e?"calc(100% - 40px)":"100%"};
      width: 100%;
      position: relative;
      .jimu-widget-placeholder{
        width: 100%;
      }
      .placeholder-alert-con{
        position: absolute;
        right: 10px;
        bottom: 10px;
      }
    }
  `,W=e=>{const{searchOn:t,notReady:n,dataSourceLabel:a,widgetLabel:l}=e,o=i.hooks.useTranslation(U,g.defaultMessages);return(0,i.jsx)("div",{className:"placeholder-table-con",css:G(t)},(0,i.jsx)(g.WidgetPlaceholder,{icon:v(59374),message:o("noData")}),n&&(0,i.jsx)("div",{className:"placeholder-alert-con"},(0,i.jsx)(g.Alert,{form:"tooltip",size:"small",type:"warning",text:o("outputDataIsNotGenerated",{outputDsLabel:a,sourceWidgetName:l})})))};var $=v(62243);const J=e=>{var t,n,a;return i.css`
  &.table-count{
    height: 16px;
    .total-count-text{
      background: ${i.polished.rgba(null===(n=null===(t=null==e?void 0:e.ref.palette)||void 0===t?void 0:t.neutral)||void 0===n?void 0:n[200],.65)};
      color: ${null===(a=e.ref.palette)||void 0===a?void 0:a.black};
      font-size: 12px;
      line-height: 16px;
      padding: 0 7px;
    }
  }
`},Q=e=>{var t,n;const{table:a,showCount:l,onSelectedChange:o}=e,[s,r]=i.React.useState((null===(t=null==a?void 0:a.viewModel)||void 0===t?void 0:t.size)||0),[d,u]=i.React.useState((null===(n=null==a?void 0:a.highlightIds)||void 0===n?void 0:n.length)||0),p=(0,i.useIntl)(),v=i.React.useMemo((()=>p.formatNumber(s,{useGrouping:!0})),[p,s]),h=i.React.useMemo((()=>p.formatNumber(d,{useGrouping:!0})),[p,d]);i.React.useEffect((()=>{const e=$.watch((()=>{var e;return null===(e=null==a?void 0:a.viewModel)||void 0===e?void 0:e.size}),(e=>{r(e||0)}),{initial:!0,sync:!0}),t=$.watch((()=>{var e;return null===(e=null==a?void 0:a.highlightIds)||void 0===e?void 0:e.length}),(e=>{u(e||0),o(e||0)}),{initial:!0,sync:!0});return()=>{null==e||e.remove(),null==t||t.remove()}}),[o,a]);const m=(0,c.useTheme)(),g=i.hooks.useTranslation(U);return(0,i.jsx)(i.React.Fragment,null,l&&(0,i.jsx)("div",{className:"table-count d-flex align-items-center",css:J(m)},(0,i.jsx)("div",{className:"flex-grow-1 total-count-text text-truncate"},g("tableCount",{total:v,selected:h}))))};var q=v(45508),X=v.n(q),Y=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(n[a[l]]=e[a[l]])}return n};const K=e=>{const t=window.SVG,{className:n}=e,a=Y(e,["className"]),l=(0,i.classNames)("jimu-icon jimu-icon-component",n);return t?i.React.createElement(t,Object.assign({className:l,src:X()},a)):i.React.createElement("svg",Object.assign({className:l},a))},Z=(e,t)=>{var n,a,l;return i.css`
  &.refresh-loading-con {
    height: 16px;
    .auto-refresh-loading {
      background: ${i.polished.rgba(null===(a=null===(n=null==e?void 0:e.ref.palette)||void 0===n?void 0:n.neutral)||void 0===a?void 0:a[200],.65)};
      color: ${null===(l=e.ref.palette)||void 0===l?void 0:l.black};
      font-size: ${i.polished.rem(12)};
      line-height: ${i.polished.rem(16)};
      ${!t&&`padding: 0 ${i.polished.rem(7)};`}
      .icon-btn{
        padding: ${i.polished.rem(1)};
      }
    }
  }
`},ee=e=>{const{needRefresh:t,showLoading:n,interval:a,isMobile:l,bottomResponsive:o,onRefresh:s}=e,r=i.hooks.useTranslation(g.defaultMessages),[d,u]=i.React.useState(r("lastUpdateAFewTime")),p=i.React.useRef(0),v=i.React.useCallback((e=>{let t=r("lastUpdateAFewTime");return e>1&&e<=2?t=r("lastUpdateAMinute"):e>2&&(t=r("lastUpdateTime",{updateTime:e})),t}),[r]);i.React.useEffect((()=>{if(a<=0)u(r("lastUpdateAFewTime")),window.clearInterval(p.current),p.current=null;else if(t){s(),u(r("lastUpdateAFewTime"));let e=0;p.current=window.setInterval((()=>{e++,u(v(e))}),6e4)}return()=>{window.clearInterval(p.current),p.current=null}}),[t,a,v,r,s]);const h=(0,c.useTheme)();return(0,i.jsx)("div",{className:"refresh-loading-con d-flex align-items-center",css:Z(h,l)},n&&(0,i.jsx)("div",{className:"loading-con"}),a>0&&(0,i.jsx)("div",{className:"flex-grow-1 auto-refresh-loading text-truncate",title:o?"":d},o?(0,i.jsx)(g.Tooltip,{title:d,showArrow:!0,placement:"top-end"},(0,i.jsx)(g.Button,{icon:!0,size:"sm",type:"tertiary",className:"d-inline jimu-outline-inside border-0 p-0"},(0,i.jsx)(K,{size:14}))):d))};var te,ne,ae,le,oe,ie,se,re,ce,de=v(92799);!function(e){e.Small="SMALL",e.Medium="MEDIUM",e.Large="LARGE"}(te||(te={})),function(e){e.String="STRING",e.Number="NUMBER",e.Date="DATE"}(ne||(ne={})),function(e){e.Blob="esriFieldTypeBlob",e.Date="esriFieldTypeDate",e.Double="esriFieldTypeDouble",e.Geometry="esriFieldTypeGeometry",e.GlobalID="esriFieldTypeGlobalID",e.GUID="esriFieldTypeGUID",e.Integer="esriFieldTypeInteger",e.OID="esriFieldTypeOID",e.Raster="esriFieldTypeRaster",e.Single="esriFieldTypeSingle",e.SmallInteger="esriFieldTypeSmallInteger",e.String="esriFieldTypeString",e.XML="esriFieldTypeXML"}(ae||(ae={})),function(e){e.Fetching="FETCHING",e.Success="SUCCESS",e.Error="ERROR"}(le||(le={})),function(e){e.Design="DESIGN",e.Run="RUN",e.Express="EXPRESS"}(oe||(oe={})),function(e){e.Opened="OPENED",e.Active="ACTIVE",e.Closed="CLOSED"}(ie||(ie={})),function(e){e.None="NONE",e.Page="PAGE",e.Dialog="DIALOG",e.View="VIEW",e.WebAddress="WEB_ADDRESS",e.Block="BLOCK",e.Screen="SCREEN",e.PageTop="PAGE_TOP",e.PrintPreview="PRINT_PREVIEW",e.CookieBanner="COOKIE_BANNER"}(se||(se={})),function(e){e.CurrentWindow="_self",e.TopWindow="_top",e.NewWindow="_blank"}(re||(re={})),function(e){e.Normal="NORMAL",e.Layout="LAYOUT"}(ce||(ce={}));var ue,pe;!function(e){e.Header="HEADER",e.Footer="FOOTER",e.Body="BODY"}(ue||(ue={})),function(e){e.Http="http:",e.Https="https:"}(pe||(pe={}));var ve,he,me;!function(e){e.Image="IMAGE",e.Config="CONFIG"}(ve||(ve={})),function(e){e.Primary="PRIMARY",e.Secondary="SECONDARY",e.Donut="DONUT",e.Bar="BAR",e.DotsPrimary="DOTS_PRIMARY",e.DotsSecondary="DOTS_SECONDARY"}(he||(he={})),function(e){e.EXB_DATA_SOURCE_ID_SET_TO_CREATED_JS_API_LAYER="_exb_data_source_id_set_to_created_js_api_layer",e.EXB_OID="_exb_oid",e.EXB_NOT_EDITABLE="_exb_not_editable",e.EXB_DATA_SOURCE="__exb_data_source",e.EXB_DATA_SET="__exb_data_set",e.EXB_LAYER_VIEW_IGNORE_SPATIAL_FILTER="__exb_layer_view_ignore_spatial_filter",e.EXB_LAYER_FROM_RUNTIME="__exb_layer_from_runtime",e.EXB_DATA_SOURCE_ID="__exb_data_source_id"}(me||(me={}));const ge={};ge[te.Large]=[{width:1024,height:768},{width:1280,height:800},{width:1280,height:1024},{width:1366,height:768},{width:1440,height:900},{width:1536,height:864},{width:1600,height:900},{width:1920,height:1080}],ge[te.Medium]=[{width:601,height:962},{width:600,height:1024},{width:768,height:1024},{width:800,height:1280},{width:834,height:1112}],ge[te.Small]=[{width:360,height:640},{width:360,height:720},{width:360,height:740},{width:375,height:667},{width:414,height:736}];var fe=function(e,t,n,a){return new(n||(n=Promise))((function(l,o){function i(e){try{r(a.next(e))}catch(e){o(e)}}function s(e){try{r(a.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?l(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}r((a=a.apply(e,t||[])).next())}))};const be=e=>{var t,l,o,s,r;const{dataInvalid:c,layerConfig:d,enableAttachments:u,tableContainer:p,canEditFeature:v,selectQueryFlag:h,tableShowColumns:m,dataActionRecords:g,selectionViewIds:f,tableSelectAsyncDs:b}=e,[y,w]=i.React.useState(),[S,x]=i.React.useState(!1),[j,R]=i.React.useState(!1),[O,I]=i.React.useState(!1),T=i.React.useRef(null),C=i.React.useRef(null),E=i.React.useRef(null),D=(e=>{const t=(null==e?void 0:e.type)===i.DataSourceTypes.SceneLayer||(null==e?void 0:e.type)===i.DataSourceTypes.BuildingComponentSubLayer;let n;return null==e||e.type,i.DataSourceTypes.OrientedImageryLayer,null==e||e.type,i.DataSourceTypes.ImageryLayer,n=t?e.getAssociatedDataSource():e,n})(A((null===(t=null==d?void 0:d.useDataSource)||void 0===t?void 0:t.dataSourceId)||(null===(l=null==d?void 0:d.dataActionDataSource)||void 0===l?void 0:l.id))),N=null===(o=null==D?void 0:D.getInfo())||void 0===o?void 0:o.status,M=i.hooks.usePrevious(N)!==i.DataSourceStatus.Unloaded&&N===i.DataSourceStatus.Unloaded,z="output"===(null==D?void 0:D.dataViewId)&&M,L=i.React.useCallback((()=>{T.current&&!T.current.destroyed&&(T.current.destroy(),T.current=null),p.current&&(p.current.innerHTML="")}),[p]);i.React.useEffect((()=>()=>{L()}),[L]),i.React.useEffect((()=>{const e=function(){return fe(this,void 0,void 0,(function*(){let e;try{e=yield null==D?void 0:D.createJSAPILayerByDataSource()}catch(e){console.log(e)}return e}))}();Promise.resolve(e).then((e=>{e&&w(e)}))}),[D,z,g,f]),i.React.useEffect((()=>{!function(){fe(this,void 0,void 0,(function*(){var e;const t=yield(n=null==y?void 0:y.url,F(void 0,void 0,void 0,(function*(){if(!n)return!1;const e=i.esri.restRequest.request;try{const t=yield e(`${n}?f=json`);return!Object.keys(t).includes("error")}catch(e){return!1}})));var n;const l=yield(e=>F(void 0,void 0,void 0,(function*(){var t;if(!e)return!1;const n=yield null==e?void 0:e.fetchItemInfo().then((e=>e)).catch((e=>{console.error(e)}));if(!n||!n.url)return!1;const a=null===(t=i.ServiceManager.getInstance().getServerInfoByServiceUrl(n.url))||void 0===t?void 0:t.owningSystemUrl;if(!a)return!1;const l=i.SessionManager.getInstance().getSessionByUrl(a);if(!l)return!1;const o=yield l.getUser(),s="org_admin"===(null==o?void 0:o.role)&&(null==n?void 0:n.isOrgItem),r=n.owner===(null==o?void 0:o.username),c=yield i.privilegeUtils.isItemInTheUpdatedGroup(n.id,l);return s||r||c})))(D),o=null==y?void 0:y.userHasFullEditingPrivileges,s=null===(e=null==y?void 0:y.editingEnabled)||void 0===e||e,r=(null==d?void 0:d.layerHonorMode)===a.Webmap,c=t||v,u=(r||(null==d?void 0:d.enableEdit))&&c;let p=!1;p=!!(l||o&&s)||!(o&&!s)&&u,x(p)}))}()}),[y,v,D,d]);const P=i.React.useCallback((()=>{const e=T.current;if(null==e?void 0:e.layer){const t=(D&&D.getCurrentQueryParams()).where;e.layer.definitionExpression=t}}),[D]),V=i.React.useCallback((()=>{var e;const t=T.current;if(!d||!t)return;const{selectMode:a}=d;(null===(e=C.current)||void 0===e?void 0:e.remove)&&C.current.remove(),C.current=t.on("cell-click",(({feature:e,objectId:l})=>{if(!e)return;if(j)return;const o=t.highlightIds;clearTimeout(E.current),E.current=setTimeout((()=>{var i;const s=l||e.getObjectId(),r=o.includes(s);if(!t.attachmentsViewOptions.objectId){a===n.Single&&t.highlightIds.removeAll(),r?t.highlightIds.remove(s):t.highlightIds.add(s);const e=null===(i=t.highlightIds)||void 0===i?void 0:i.toArray();0===(null==e?void 0:e.length)&&(h&&(t.filterBySelectionEnabled=!1),P()),b(e)}else b([l||e.getObjectId()])}),200)})),t.on("cell-dblclick",(()=>{clearTimeout(E.current)}))}),[j,d,P,h,b]);i.React.useEffect((()=>{var e;(null==d?void 0:d.enableSelect)?V():(null===(e=C.current)||void 0===e?void 0:e.remove)&&C.current.remove()}),[null==d?void 0:d.enableSelect,j,V]);const B=i.React.useCallback((()=>{var e;const t=T.current;if(!d)return;const n=k(D,d,m);t.tableTemplate=n,0===(null===(e=n.columnTemplates)||void 0===e?void 0:e.length)?t.visible=!1:t.visible=!0}),[D,d,m]),H=i.hooks.usePrevious(d),U=i.hooks.usePrevious(u),G=i.hooks.usePrevious(y),W=i.hooks.usePrevious(S),J=i.React.useCallback((e=>{var t,n,a;const{updatedFeatures:l,deletedFeatures:o}=e,i=l&&l.length>0,s=o&&o.length>0;if(i){const a=null===(n=null===(t=null==e?void 0:e.edits)||void 0===t?void 0:t.updateFeatures)||void 0===n?void 0:n[0];if(a){const e=D.buildRecord(a);D.afterUpdateRecord(e)}}if(s){const t=null===(a=null==e?void 0:e.edits)||void 0===a?void 0:a.deleteFeatures;if((null==t?void 0:t.length)>0){const e=[];t.forEach((t=>{const n=D.buildRecord(t);e.push(n.getId())})),D.afterDeleteRecordsByIds(e)}}}),[D]);if(c)T.current&&L();else if(p.current&&D&&y){const e=d.id!==(null==H?void 0:H.id),t=!i.lodash.isDeepEqual(d,H),n=!i.lodash.isDeepEqual(y,G);if(!T.current||n||e){L();const e=document.createElement("div");if(e.className="h-100",p.current.appendChild(e),T.current=new de.default({container:e,layer:y,attachmentsEnabled:u,visibleElements:{columnDescriptions:!1,header:!1,menu:!1,menuItems:{clearSelection:!1,refreshData:!1,toggleColumns:!1},selectionColumn:!1},menuConfig:{items:[]},multiSortEnabled:!0,editingEnabled:S,timeZone:_(D)}),(null==d?void 0:d.enableSelect)?V():(null===(s=C.current)||void 0===s?void 0:s.remove)&&C.current.remove(),B(),"subtype-sublayer"===y.type){y.parent.on("edits",J)}else y.on("edits",J)}const a=T.current;if(S!==W&&(a.editingEnabled=S),U!==u){a.attachmentsEnabled=u;const e=null===(r=a.columns)||void 0===r?void 0:r.toArray();null==e||e.forEach((e=>{const t=e;t.hidden&&(a.showColumn(t.fieldName),setTimeout((()=>{a.hideColumn(t.fieldName)}),100))}))}d&&d.id===(null==H?void 0:H.id)&&t&&B()}const Q=T.current;return i.React.useEffect((()=>{const e=$.watch((()=>null==Q?void 0:Q.state),(e=>{I("loaded"===e)}),{initial:!0,sync:!0}),t=$.watch((()=>{var e;return null===(e=null==Q?void 0:Q.columns)||void 0===e?void 0:e.toArray().some((e=>e.editing))}),(e=>{R(e)}),{initial:!0,sync:!0});return()=>{null==e||e.remove(),null==t||t.remove()}}),[Q]),[T.current,O]};var ye=v(65959),we=v.n(ye),Se=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(n[a[l]]=e[a[l]])}return n};const xe=e=>{const t=window.SVG,{className:n}=e,a=Se(e,["className"]),l=(0,i.classNames)("jimu-icon jimu-icon-component",n);return t?i.React.createElement(t,Object.assign({className:l,src:we()},a)):i.React.createElement("svg",Object.assign({className:l},a))};var je=v(7835),Re=v.n(je),Oe=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(n[a[l]]=e[a[l]])}return n};const Ie=e=>{const t=window.SVG,{className:n}=e,a=Oe(e,["className"]),l=(0,i.classNames)("jimu-icon jimu-icon-component",n);return t?i.React.createElement(t,Object.assign({className:l,src:Re()},a)):i.React.createElement("svg",Object.assign({className:l},a))};var Te=v(27964),Ce=v.n(Te),Ee=v(20904),De=v.n(Ee),Ne=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(n[a[l]]=e[a[l]])}return n};const Me=e=>{const t=window.SVG,{className:n}=e,a=Ne(e,["className"]),l=(0,i.classNames)("jimu-icon jimu-icon-component has-rtl-svg",n);return t?i.React.createElement(t,Object.assign({className:l,src:Ce(),srcRTL:De()},a)):i.React.createElement("svg",Object.assign({className:l},a))};var Ae=v(4583),ze=v.n(Ae),Le=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(n[a[l]]=e[a[l]])}return n};const Fe=e=>{const t=window.SVG,{className:n}=e,a=Le(e,["className"]),l=(0,i.classNames)("jimu-icon jimu-icon-component",n);return t?i.React.createElement(t,Object.assign({className:l,src:ze()},a)):i.React.createElement("svg",Object.assign({className:l},a))};var Pe=v(21935),_e=v.n(Pe),Ve=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(n[a[l]]=e[a[l]])}return n};const ke=e=>{const t=window.SVG,{className:n}=e,a=Ve(e,["className"]),l=(0,i.classNames)("jimu-icon jimu-icon-component",n);return t?i.React.createElement(t,Object.assign({className:l,src:_e()},a)):i.React.createElement("svg",Object.assign({className:l},a))};var Be=v(9044),He=v.n(Be),Ue=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(n[a[l]]=e[a[l]])}return n};const Ge=e=>{const t=window.SVG,{className:n}=e,a=Ue(e,["className"]),l=(0,i.classNames)("jimu-icon jimu-icon-component",n);return t?i.React.createElement(t,Object.assign({className:l,src:He()},a)):i.React.createElement("svg",Object.assign({className:l},a))};var We=function(e,t,n,a){return new(n||(n=Promise))((function(l,o){function i(e){try{r(a.next(e))}catch(e){o(e)}}function s(e){try{r(a.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?l(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}r((a=a.apply(e,t||[])).next())}))};function $e(e){return i.css`
    .esri-button-menu__item .esri-button-menu__item-label{
      padding: 4px 15px !important;
    }
    .table-popup-search{
      .search-icon{
        z-index: 2;
      }
      .popup-search-input{
        border: 1px solid ${e.ref.palette.neutral[500]};
        border-radius: 2px;
        .input-wrapper{
          height: 30px;
          border: none;
        }
      }
    }
    .table-action-option{
      width: 100%;
      display: inline-flex;
      flex-direction: row;
      .table-action-option-tab{
        margin: auto 8px;
      }
      .table-action-option-close{
        flex: 1;
        button{
          :hover {
            color: ${e.ref.palette.white};
          }
          float: right;
        }
      }
    }
    .esri-popover--open{
      z-index: 1005 !important;
      .esri-date-picker__calendar{
        background-color: ${e.ref.palette.white};
      }
    }
    .table-hide-hover-color{
      color: unset !important;
      border: none !important;
      &:hover{
        color: unset !important; /* use color of dropdown item */
      }
    }
  `}var Je=v(49419),Qe=v.n(Je),qe=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(n[a[l]]=e[a[l]])}return n};const Xe=e=>{const t=window.SVG,{className:n}=e,a=qe(e,["className"]),l=(0,i.classNames)("jimu-icon jimu-icon-component",n);return t?i.React.createElement(t,Object.assign({className:l,src:Qe()},a)):i.React.createElement("svg",Object.assign({className:l},a))};var Ye=v(4651),Ke=v.n(Ye),Ze=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(n[a[l]]=e[a[l]])}return n};const et=e=>{const t=window.SVG,{className:n}=e,a=Ze(e,["className"]),l=(0,i.classNames)("jimu-icon jimu-icon-component",n);return t?i.React.createElement(t,Object.assign({className:l,src:Ke()},a)):i.React.createElement("svg",Object.assign({className:l},a))},tt=(e,t,n)=>i.css`
    &.top-button-list{
      ${!e&&!t&&"\n        position: absolute;\n        right: 17px;\n      "}
      ${n?"display: none":"display: flex"};
      .top-button{
        display: inline-flex;
        button{
          width: 32px;
          height: 32px;
        }
      }
    }
  `,nt=(e,t,n)=>i.css`
    &.dropdown-list-container{
      ${e&&"\n        position: absolute;\n        right: 17px;\n        top: 55px;\n      "}
      ${!e&&!t&&"\n        position: absolute;\n        right: 17px;\n      "}
      .dropdown-list{
        ${!n&&"display: none;"}
        width: 32px;
        height: 32px;
      }
      .horizontal-action-dropdown{
        button{
          width: 32px;
          height: 32px;
        }
      }
    }
  `,at=e=>{var n;const{usedState:l,curLayerConfig:o,dataSource:s,dsSelection:r,isMapMode:c,arrangeType:d,enableMapExtentFilter:u,widgetId:p,enableDataAction:v,getInitFields:h,onShowSelection:m,resetTable:f,onTableRefresh:b,onDeleteSelection:y,onValueChangeFromRuntime:w,toggleMapFilter:S}=e,{activeTabId:x,selectQueryFlag:j,tableShowColumns:R,mobileFlag:O,emptyTable:I,tableLoaded:T,tableSelected:C,allowDel:N,mapFilterEnabled:M,allLayersConfig:A}=l,z=i.hooks.useTranslation(U,g.defaultMessages),L=(null==o?void 0:o.enableSearch)&&0!==(null===(n=null==o?void 0:o.searchFields)||void 0===n?void 0:n.length),F=d===t.Tabs,P=C>0,_=c&&u,V=o.layerHonorMode===a.Webmap,{popupAllFields:k,actionUsedFields:B}=function(e,t){var n;if(!e)return{popupAllFields:[],actionUsedFields:[]};const l=[];if(t){const a=null==t?void 0:t.getSchema();if(!(null==a?void 0:a.fields))return{popupAllFields:[],actionUsedFields:[]};const o=Object.keys(null==a?void 0:a.fields),i=null==t?void 0:t.getPopupInfo();if(i){const e=(i.fieldInfos||[]).filter((e=>o.includes(e.fieldName))).filter((e=>!D.includes(e.fieldName)));for(const t of e)t.visible&&l.push({value:t.fieldName,label:t.label||t.fieldName})}else{const a=null===(n=null==t?void 0:t.getLayerDefinition())||void 0===n?void 0:n.fields,i=((null==a?void 0:a.length)>0?a:e.allFields).filter((e=>o.includes(e.jimuName||e.name))).filter((e=>!D.includes(e.jimuName||e.name)));for(const e of i)l.push({value:e.name,label:e.alias||e.name})}}const o=e.layerHonorMode===a.Webmap?l.map((e=>e.value)):e.tableFields.map((e=>e.jimuName));return{popupAllFields:l,actionUsedFields:o}}(o,s),H=h(),G=null==s?void 0:s.getLabel(),W=z("tableDataActionLabel",{layer:G||""}),$=i.React.useMemo((()=>{var e;return null===(e=o.tableFields)||void 0===e?void 0:e.map((e=>({value:e.name,label:e.alias})))}),[o]),J=(0,i.jsx)("div",{className:"d-flex ml-2 dropdown-list-container",css:nt(L,F,O)},(0,i.jsx)(g.Dropdown,{size:"sm",className:"d-inline-flex dropdown-list"},(0,i.jsx)(g.DropdownButton,{arrow:!1,icon:!0,size:"sm",title:z("options")},(0,i.jsx)(et,null)),(0,i.jsx)(g.DropdownMenu,null,o.enableSelect&&(0,i.jsx)(E.Fragment,null,(0,i.jsx)(g.DropdownItem,{key:"showSelection",onClick:m,disabled:!T||I||!P},j?(0,i.jsx)(Ie,{className:"mr-1"}):(0,i.jsx)(Me,{className:"mr-1",autoFlip:!0}),z(j?"showAll":"showSelection")),(0,i.jsx)(g.DropdownItem,{key:"clearSelection",onClick:f,disabled:!T||I||!P},(0,i.jsx)(Fe,{className:"mr-1"}),z("clearSelection"))),o.enableRefresh&&(0,i.jsx)(g.DropdownItem,{key:"refresh",onClick:b,disabled:!T||I},(0,i.jsx)(ke,{className:"mr-1"}),z("refresh")),N&&(0,i.jsx)(g.DropdownItem,{key:"delete",onClick:y,disabled:!T||I||!P},(0,i.jsx)(Ge,{className:"mr-1"}),z("deleteRecords")),(0,i.jsx)(g.DropdownItem,{key:"showHideCols",tag:"div",toggle:!1,disabled:!T||I},(0,i.jsx)(g.AdvancedSelect,{size:"sm",title:z("showHideCols"),buttonProps:{arrow:!1,type:"tertiary",className:"p-0 table-hide-hover-color"},fluid:!0,staticValues:V?k:$,sortValuesByLabel:!1,isMultiple:!0,selectedValues:R||H,isEmptyOptionHidden:!1,onChange:w,customDropdownButtonContent:()=>(0,i.jsx)(E.Fragment,null,(0,i.jsx)(Xe,{className:"mr-1"}),z("showHideCols"))})))),s&&O&&(0,i.jsx)(E.Fragment,null,_&&(0,i.jsx)(E.Fragment,null,(0,i.jsx)("span",{className:"tool-dividing-line"}),(0,i.jsx)("div",{className:"mobile-map-button mr-2"},(0,i.jsx)(g.Button,{icon:!0,size:"sm",onClick:S,variant:M?"contained":"outlined",color:M?"primary":"default",title:z("enableMapExtentFilter"),"aria-label":z("enableMapExtentFilter"),disabled:!T||I,"aria-pressed":M},(0,i.jsx)(xe,null)))),v&&(0,i.jsx)(E.Fragment,null,A.map((e=>e.id===x&&!I?(0,i.jsx)(E.Fragment,{key:e.id},!_&&(0,i.jsx)("span",{className:"tool-dividing-line"}),(0,i.jsx)("div",{className:"horizontal-action-dropdown"},(0,i.jsx)(g.DataActionList,{widgetId:p,listStyle:g.DataActionListStyle.Dropdown,dataSets:[{dataSource:s,type:"selected",records:r,fields:B,name:W}]}))):""))))),Q=(0,i.jsx)("div",{className:"top-button-list",css:tt(L,F,O)},o.enableSelect&&(0,i.jsx)("div",{className:"top-button ml-2"},(0,i.jsx)(g.Button,{size:"sm",onClick:m,icon:!0,title:z(j?"showAll":"showSelection"),"aria-label":z(j?"showAll":"showSelection"),disabled:!T||I||!P},j?(0,i.jsx)(Ie,null):(0,i.jsx)(Me,{autoFlip:!0}))),o.enableSelect&&(0,i.jsx)("div",{className:"top-button ml-2"},(0,i.jsx)(g.Button,{size:"sm",onClick:f,icon:!0,title:z("clearSelection"),"aria-label":z("clearSelection"),disabled:!T||I||!P},(0,i.jsx)(Fe,null))),o.enableRefresh&&(0,i.jsx)("div",{className:"top-button ml-2"},(0,i.jsx)(g.Button,{size:"sm",onClick:b,icon:!0,title:z("refresh"),"aria-label":z("refresh"),disabled:!T||I},(0,i.jsx)(ke,null))),N&&(0,i.jsx)("div",{className:"top-button ml-2"},(0,i.jsx)(g.Button,{size:"sm",onClick:y,icon:!0,title:z("deleteRecords"),"aria-label":z("deleteRecords"),disabled:!T||I||!P},(0,i.jsx)(Ge,null))),(0,i.jsx)("div",{className:"top-button ml-2"},(0,i.jsx)(g.AdvancedSelect,{size:"sm",title:z("showHideCols"),"aria-label":z("showHideCols"),buttonProps:{icon:!0,disabled:!T||I,arrow:!1},fluid:!0,staticValues:V?k:$,sortValuesByLabel:!1,isMultiple:!0,selectedValues:R||H,isEmptyOptionHidden:!1,onChange:w,customDropdownButtonContent:()=>(0,i.jsx)(Xe,null)})),_&&(0,i.jsx)(E.Fragment,null,(0,i.jsx)("span",{className:"tool-dividing-line"}),(0,i.jsx)("div",{className:"top-button mr-2"},(0,i.jsx)(g.Button,{icon:!0,size:"sm",onClick:S,variant:M?"contained":"outlined",color:M?"primary":"default",title:z("enableMapExtentFilter"),"aria-label":z("enableMapExtentFilter"),disabled:!T||I,"aria-pressed":M},(0,i.jsx)(xe,null)))),s&&!O&&v&&(0,i.jsx)(E.Fragment,null,A.map((e=>e.id===x&&!I?(0,i.jsx)(E.Fragment,{key:e.id},!_&&(0,i.jsx)("span",{className:"tool-dividing-line"}),(0,i.jsx)("div",{className:"top-button data-action-btn"},(0,i.jsx)(g.DataActionList,{widgetId:p,listStyle:g.DataActionListStyle.Dropdown,dataSets:[{dataSource:s,type:"selected",records:r,fields:B,name:W}]}))):""))));return O?J:Q};var lt=v(62686),ot=function(e,t,n,a){return new(n||(n=Promise))((function(l,o){function i(e){try{r(a.next(e))}catch(e){o(e)}}function s(e){try{r(a.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?l(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}r((a=a.apply(e,t||[])).next())}))};const it=e=>{const{useMapWidgetIds:t,mapViewsConfig:n,mapFilterEnabled:a,onUpdateViewExtent:l,onRestTableGeometry:o,onLayersConfigChange:s}=e,[r,c]=i.React.useState(null),d=null==t?void 0:t[0],u=i.React.useCallback((()=>ot(void 0,void 0,void 0,(function*(){var e,t;if(r){const a=null===(t=null===(e=null==n?void 0:n[null==r?void 0:r.id])||void 0===e?void 0:e.asMutable)||void 0===t?void 0:t.call(e,{deep:!0}),l=yield((e,t)=>F(void 0,void 0,void 0,(function*(){if(!t)return[];const n=[];yield t.whenJimuMapViewLoaded();const a=t.getAllJimuLayerViews(),l=t.getJimuTables(),{layersConfig:o=[],customJimuLayerViewIds:i=[],customizeLayers:s}=e||{};for(const e of a){const t=e.id;if(!M(e))continue;const{layerDataSourceId:a}=e,l=null==e?void 0:e.fromRuntime,r=e.isLayerVisible();if(!(l?!s&&r:s?i.includes(t):r))continue;const c=t.indexOf("-"),d=t.substring(c+1),u=o.find((e=>e.id===d));let p=(null==e?void 0:e.getLayerDataSource())||P.getDataSource(a);if(!p){try{p=yield e.createLayerDataSource()}catch(e){continue}p=yield e.createLayerDataSource()}const v=null==p?void 0:p.getSchema();if(!p||!(null==v?void 0:v.fields))continue;const h=B(p,!0,void 0,e.jimuMapViewId);if(u)if(0!==z(h.allFields,u.allFields).length){const e=Object.assign(Object.assign({},u),{name:h.name,useDataSource:h.useDataSource,allFields:h.allFields,tableFields:h.tableFields});n.push(e)}else n.push(u);else n.push(h)}for(const e of l){const a=e.table,l=e.jimuTableId,{visible:r}=a,c=t.getDataSourceIdByAPILayer(a);if(!(s?i.includes(l):r))continue;const d=l.indexOf("-"),u=l.substring(d+1),p=o.find((e=>e.id===u)),v=P.getDataSource(c),h=t.getMapDataSource();let m=v;if(!v&&h)try{m=yield h.createDataSourceByLayer(a)}catch(e){continue}if(!m)continue;const g=B(m,!0);if(p)if(0!==z(g.allFields,p.allFields).length){const e=Object.assign(Object.assign({},p),{name:g.name,useDataSource:g.useDataSource,allFields:g.allFields,tableFields:g.tableFields});n.push(e)}else n.push(p);else n.push(g)}return n})))(a,r);s(l)}else s([])}))),[r,n,s]),p=i.React.useCallback((e=>ot(void 0,void 0,void 0,(function*(){e&&e.view&&(yield e.whenJimuMapViewLoaded(),yield e.whenAllJimuLayerViewLoaded()),c(e)}))),[]),v=i.hooks.useLatest(u),h=i.React.useCallback((e=>{var t;null===(t=v.current)||void 0===t||t.call(v)}),[v]),m=i.React.useCallback((e=>{var t;e.fromRuntime&&(null===(t=v.current)||void 0===t||t.call(v))}),[v]),g=i.React.useCallback((e=>{var t;e.fromRuntime&&(null===(t=v.current)||void 0===t||t.call(v))}),[v]);i.React.useEffect((()=>{const e=window.setTimeout(u,50);return()=>{window.clearTimeout(e)}}),[u]),i.React.useEffect((()=>{if(!r||!r.view)return;r.addJimuLayerViewsVisibleChangeListener(h),r.addJimuLayerViewCreatedListener(m),r.addJimuLayerViewRemovedListener(g);const e=r;return()=>{e&&(e.removeJimuLayerViewsVisibleChangeListener(h),e.removeJimuLayerViewCreatedListener(m),e.removeJimuLayerViewRemovedListener(g))}}),[r,m,g,h]);const f=i.React.useRef(null),b=i.React.useCallback((e=>{null!==f.current&&window.clearTimeout(f.current),f.current=window.setTimeout((()=>{l(e)}),500)}),[l]);return i.React.useEffect((()=>{let e;if(r&&r.view&&a){const t=r.view,n=t.extent.clone();b(n),e=$.watch((()=>null==t?void 0:t.extent),(e=>{b(e)}))}return a||(b(),o()),()=>{var t;null===(t=null==e?void 0:e.remove)||void 0===t||t.call(e)}}),[b,r,a,o]),(0,i.jsx)(lt.JimuMapViewComponent,{useMapWidgetId:d,onActiveViewChange:p})};var st=v(41496),rt=v(77958);const ct={notReady:!1,emptyTable:!1,showLoading:!1,interval:0,needRefresh:!1,selectedRecords:[]},dt=e=>{const{widgetId:t,curLayerConfig:n,widgetState:a,onDataSourceCreated:l,onCreateDataSourceFailed:s,onUpdateLayerInfo:r,onTimeExtentChange:c,onGdbVersionChange:d,onBelongToSourceVersionChange:u,onNeedRefresh:p,onWidgetQueryChange:v}=e,[h,m]=i.React.useState(ct);i.React.useEffect((()=>{r(h)}),[h,r]);const g=i.React.useCallback(((e,t)=>{if(!n)return;const l=Object.assign({},h),o=ut(n);if(!e||!o)return l.notReady=!1,l.emptyTable=!0,void m(l);const s=null==t?void 0:t.sourceVersion,r=null==e?void 0:e.sourceVersion,c=null==e?void 0:e.version,d=null==t?void 0:t.version;(r!==s||c!==d)&&a!==i.WidgetState.Active&&p();const u="selection"===(null==o?void 0:o.dataViewId),v=null==o?void 0:o.getSourceRecords(),g=v.map((e=>e.getId())).join(",");if(u&&0!==(null==v?void 0:v.length))return l.notReady=!1,l.emptyTable=!1,l.selectedRecords=null==o?void 0:o.getSelectedRecords(),l.selectionViewIds=g,void m(l);const f=u&&0===(null==v?void 0:v.length);if(!n.dataActionObject&&(e.status===i.DataSourceStatus.NotReady||f))return l.notReady=!0,l.emptyTable=!0,l.selectionViewIds=g,void m(l);l.notReady=!1,l.emptyTable=!1,l.selectionViewIds=g,l.showLoading=function(e,t){let n=!1;(window.jimuConfig.isInBuilder||e&&t===i.DataSourceStatus.Loading)&&(n=!0);return n}(o,e.status);const b=o.getAutoRefreshInterval()||0;l.interval=b;const y=e.needRefresh&&b>0;l.needRefresh=y;const w=null==t?void 0:t.selectedIds,S=null==e?void 0:e.selectedIds;i.lodash.isDeepEqual(w,S)||(l.selectedRecords=o.getSelectedRecords()),m(l)}),[n,a,h,p]),f=i.React.useCallback(((e,t,n=!1)=>{const{widgetQueries:a,gdbVersion:l,sourceVersion:o}=t,{widgetQueries:i,gdbVersion:s,needRefresh:r,sourceVersion:c}=e;if(l&&s&&s!==l)return void d(s);r&&p();if(n&&o!==c)return void u();i&&i!==a&&v()}),[u,d,p,v]),b=i.React.useCallback(((e,t)=>{var a;if((null==n?void 0:n.dataActionObject)&&(null==n?void 0:n.dataActionType)===o.View||!t||!n)return;const l=ut(n);if(!l)return;const i=l.getCurrentQueryParams(),s=null==i?void 0:i.time;c(s);const r=l.id,d=null==e?void 0:e[r],u=null==t?void 0:t[r],p=null===(a=null==l?void 0:l.belongToDataSource)||void 0===a?void 0:a.id,v=null==e?void 0:e[p],h=null==t?void 0:t[p];(d||v)&&(v?f(v,h,!0):f(d,u))}),[f,n,c]),y=null==n?void 0:n.useDataSource,w=pt(n);return(0,i.jsx)(i.DataSourceComponent,{widgetId:t,useDataSource:(0,i.Immutable)(y),dataSource:w,onDataSourceCreated:l,onCreateDataSourceFailed:s,onDataSourceInfoChange:g,onQueryRequired:b})};function ut(e){var t;const n=null===(t=null==e?void 0:e.useDataSource)||void 0===t?void 0:t.dataSourceId;let a=A(n);return a||(a=pt(e)),a}function pt(e){let t=null;return(null==e?void 0:e.dataActionObject)&&(t=e.dataActionDataSource),t}var vt=v(31526);const{BREAK_POINTS:ht}=i.CONSTANTS,mt=v(4280),gt={where:"1=1",sqlExpression:null},ft=n=>{var l,s,r,d,u;const{id:p,config:v,useMapWidgetIds:h,layoutId:m,layoutItemId:b,stateProps:y,mutableStateProps:w,state:S}=n,{tableMode:x,arrangeType:j,layersConfig:R,mapViewsConfig:O,enableMapExtentFilter:I,defaultExtentFilterEnabled:T,enableAttachments:E}=v,D=(0,c.useTheme)(),N=x===e.Map,[M,A]=i.React.useState(!1),[L,F]=i.React.useState([]),[P,_]=i.React.useState([]),[V,k]=i.React.useState(),[B,U]=i.React.useState(!1),[G,J]=i.React.useState(!1),[q,X]=i.React.useState(!1),[Y,K]=i.React.useState(!1),[Z,te]=i.React.useState(600),[ne,ae]=i.React.useState(),[le,oe]=i.React.useState(0),[ie,se]=i.React.useState(!1),[re,ce]=i.React.useState(!1),[de,ue]=i.React.useState(!1),[pe,ve]=i.React.useState(!1),[he,me]=i.React.useState(0),[ge,fe]=i.React.useState(!1),[ye,we]=i.React.useState([]),[Se,xe]=i.React.useState(""),je=i.React.useRef(null),Re=i.React.useRef({}),Oe=i.React.useRef(!1),Ie=i.React.useRef(!1),Te=i.React.useRef(),Ce=i.ReactRedux.useSelector((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode})),Ee=i.ReactRedux.useSelector((e=>{var t;const n=e.appConfig,a=null===(t=null==n?void 0:n.widgets)||void 0===t?void 0:t[p],l=null==a?void 0:a.enableDataAction;return void 0===l||l})),De=i.ReactRedux.useSelector((e=>{var t,n,a,l,o;const i=e.appConfig,s=null===(t=null==i?void 0:i.layouts)||void 0===t?void 0:t[m],r=null===(a=null===(n=null==s?void 0:s.content)||void 0===n?void 0:n[b])||void 0===a?void 0:a.setting;return(null===(l=null==r?void 0:r.autoProps)||void 0===l?void 0:l.height)===st.LayoutItemSizeModes.Auto||!0===(null===(o=null==r?void 0:r.autoProps)||void 0===o?void 0:o.height)})),Ne=i.ReactRedux.useSelector((e=>{var t,n,a,l,o;const i=e.appConfig,s=null===(t=null==i?void 0:i.layouts)||void 0===t?void 0:t[m],r=null===(a=null===(n=null==s?void 0:s.content)||void 0===n?void 0:n[b])||void 0===a?void 0:a.setting;return(null===(l=null==r?void 0:r.autoProps)||void 0===l?void 0:l.width)===st.LayoutItemSizeModes.Auto||!0===(null===(o=null==r?void 0:r.autoProps)||void 0===o?void 0:o.width)})),Me=(0,i.classNames)("jimu-widget","widget-table","table-widget-"+p),Ae=j===t.Tabs,ze=P.find((e=>e.id===V)),Le=M&&(null==ze?void 0:ze.enableDelete),Fe=null===(l=(0,i.getAppStore)().getState())||void 0===l?void 0:l.appConfig,Pe=null==ze?void 0:ze.useDataSource,_e=i.appConfigUtils.getWidgetIdByOutputDataSource(Pe),Ve=null===(r=null===(s=null==Fe?void 0:Fe.widgets)||void 0===s?void 0:s[_e])||void 0===r?void 0:r.label,ke=(null==ze?void 0:ze.enableSearch)&&0!==(null===(d=null==ze?void 0:ze.searchFields)||void 0===d?void 0:d.length),Be=i.DataSourceManager.getInstance(),He=i.ReactRedux.useSelector((e=>{var t;return Pe?Be.getDataSource(null===(t=null==ze?void 0:ze.useDataSource)||void 0===t?void 0:t.dataSourceId):null==ze?void 0:ze.dataActionDataSource})),Ue=(null==w?void 0:w.viewInTableObj)&&Object.keys(w.viewInTableObj).join("|"),Ge=i.React.useCallback((e=>{if(!He)return;const t=e=>{i.MessageManager.getInstance().publishMessage(new i.DataRecordsSelectionChangeMessage(p,e,[He.id])),e.length>0?He.selectRecordsByIds(e.map((e=>e.getId())),e):He.clearSelection()};(null==e?void 0:e.length)>0?He.query({objectIds:e,returnGeometry:!0,outFields:["*"],notAddFieldsToClient:!0},{scope:i.QueryScope.InAllData}).then((e=>{const n=null==e?void 0:e.records;n&&t(n)})):t([])}),[He,p]),Je={dataInvalid:re,layerConfig:ze,enableAttachments:E,tableContainer:je,canEditFeature:M,selectQueryFlag:B,tableShowColumns:ne,dataActionRecords:null===(u=Re.current)||void 0===u?void 0:u[null==ze?void 0:ze.id],selectionViewIds:Se,tableSelectAsyncDs:Ge},[Qe,qe]=be(Je),Xe={id:p,enableDataAction:Ee,isHeightAuto:De,isWidthAuto:Ne,headerFontSetting:null==ze?void 0:ze.headerFontSetting,emptyTable:re,isHorizontalTab:Ae,widgetWidth:Z},Ye={activeTabId:V,selectQueryFlag:B,tableShowColumns:ne,mobileFlag:G,emptyTable:re,tableLoaded:qe,tableSelected:le,allowDel:Le,mapFilterEnabled:ie,allLayersConfig:P},Ke=i.hooks.usePrevious(ke),Ze=i.hooks.usePrevious(Ue),et=i.React.useCallback((()=>{const e=null==w?void 0:w.viewInTableObj,t=[];if(!Ue)return t;const n=Ue.split("|");return null==n||n.forEach((n=>{const a=e[n];Re.current[n]=a.records,t.push(Object.assign({},a.daLayerItem))})),t}),[null==w?void 0:w.viewInTableObj,Ue]),tt=i.React.useCallback((e=>{F(e)}),[]),nt=i.React.useCallback((e=>{if(!ze||!He)return;const t=((e,t,n)=>{let a="1=1",l=null;if(!n)return null;if(!n.query)return null;if(t&&e.enableSearch&&e.searchFields){const o=i.dataSourceUtils.getSQL(t,e.searchFields,n,null==e?void 0:e.searchExact);a=o.sql,l=o}return{where:a,sqlExpression:l}})(ze,e,He);He.updateQueryParams(t,p)}),[ze,He,p]),lt=i.React.useCallback((e=>{k(e),U(!1),ae(void 0),(0,i.getAppStore)().dispatch(i.appActions.widgetStatePropChange(p,"activeTabId",e))}),[p]),ot=i.React.useCallback((()=>{if(null==Qe?void 0:Qe.layer){const e=(He&&He.getCurrentQueryParams()).where;Qe.layer.definitionExpression=e}}),[He,Qe]),ct=i.React.useCallback((()=>{var e,t;if(!He)return;let n=He.getSelectedRecordIds();const a=(null===(e=null==He?void 0:He.belongToDataSource)||void 0===e?void 0:e.getSelectedRecordIds())||[];He.isDataView&&n.length!==a.length&&(n=a||n),(null===(t=Qe.highlightIds)||void 0===t?void 0:t.removeAll)&&Qe.highlightIds.removeAll();const l=n.map((e=>parseInt(e)));Qe.highlightIds.addMany(l)}),[He,Qe]),ut=i.React.useCallback((e=>{if(!(null==Qe?void 0:Qe.layer)||!He)return;Oe.current=!1;const t=null==He?void 0:He.getCurrentQueryParams(),n=Qe.layer.definitionExpression;if(!(""===n&&"1=1"===(null==t?void 0:t.where))&&n!==(null==t?void 0:t.where))if(qe)if(Qe.isQueryingOrSyncing){let e=$.watch((()=>Qe.isQueryingOrSyncing),(()=>{if(!Qe.isQueryingOrSyncing){e&&(e.remove(),e=null);const n=null==He?void 0:He.getCurrentQueryParams();Qe.layer&&(null==t?void 0:t.where)===(null==n?void 0:n.where)&&Qe.layer.definitionExpression!==(null==t?void 0:t.where)&&(Qe.layer.definitionExpression=null==t?void 0:t.where)}}))}else Qe.layer.definitionExpression=null==t?void 0:t.where;else Oe.current=!0;e||i.dataSourceUtils.changeJimuArcGISQueryToJSAPIQuery(He,(0,i.Immutable)(t)).then((e=>{var t;if(!e)return Promise.resolve();const{geometry:n,distance:a,units:l}=e;if(!n)return Qe.filterGeometry=null,Promise.resolve();const o=null==n?void 0:n.spatialReference,s=null==n?void 0:n.type,{isWGS84:r,isWebMercator:c}=o,d=r||c?rt.geodesicBuffer:rt.buffer,u=null===(t=null==Qe?void 0:Qe.filterGeometry)||void 0===t?void 0:t.toJSON();if("polygon"!==s&&a&&a<=0){const e=new vt.default({rings:[]});i.lodash.isDeepEqual(u,null==e?void 0:e.toJSON())||(Qe.filterGeometry=e)}else if(a&&l){const e=d(n,a,l);i.lodash.isDeepEqual(u,null==e?void 0:e.toJSON())||(Qe.filterGeometry=e)}else Qe.filterGeometry=n;return Promise.resolve()})).then((()=>{Ie.current=!0}))}),[He,Qe,qe]);i.React.useEffect((()=>{const e=et(),t=L.concat(e);_(t)}),[L,et]),i.React.useEffect((()=>{const e=Ue?Ue.split("|"):[],t=Ze?Ze.split("|"):[];if(e.length>t.length){const n=((e,t)=>{const n=e.length>t.length,a=n?t:e;return(n?e:t).filter((e=>!a.some((t=>t===e))))})(e,t);k(n[0])}}),[Ze,Ue]),i.React.useEffect((()=>()=>{i.MutableStoreManager.getInstance().updateStateValue(p,"viewInTableObj",{})}),[p]),i.React.useEffect((()=>{We(void 0,void 0,void 0,(function*(){var e;const t=yield i.privilegeUtils.checkExbAccess(i.privilegeUtils.CheckTarget.Experience);return null===(e=null==t?void 0:t.capabilities)||void 0===e?void 0:e.canEditFeature})).then((e=>{A(e)}))}),[]),i.React.useEffect((()=>{var e;const t=S===i.WidgetState.Active;if(Qe&&He&&t&&Ie.current&&(Ie.current=!1,ct()),Qe&&He&&!t){const t=((null==ze?void 0:ze.dataActionType)===o.View?He.getSelectedRecords():ye)||[];(null===(e=Qe.highlightIds)||void 0===e?void 0:e.removeAll)&&Qe.highlightIds.removeAll();const n=t.map((e=>parseInt(e.getId())));Qe.highlightIds.addMany(n)}}),[S,Qe,He,null==ze?void 0:ze.dataActionType,ye,ct]),i.React.useEffect((()=>{var e;const t=S===i.WidgetState.Active;if(Qe&&He&&t){const t=He.getSelectedRecords()||[];(null===(e=Qe.highlightIds)||void 0===e?void 0:e.removeAll)&&Qe.highlightIds.removeAll();const n=t.map((e=>parseInt(e.getId())));Qe.highlightIds.addMany(n)}}),[S,Qe,He]),i.React.useEffect((()=>{Qe&&He&&B&&0===(null==ye?void 0:ye.length)&&(Qe.filterBySelectionEnabled=!1,ot(),U(!B))}),[Qe,He,B,ye,ot]),i.React.useEffect((()=>{N||F(null==R?void 0:R.asMutable({deep:!0}))}),[N,R]),i.React.useEffect((()=>{(!V||P.findIndex((e=>e.id===V))<0)&&P.length>0&&k(P[0].id)}),[P,V]),i.React.useEffect((()=>{se(I&&T)}),[I,T]),i.React.useEffect((()=>{const e=(null==y?void 0:y.settingChangeTab)||!1,t=null==y?void 0:y.activeTabId;e&&t&&V!==t&&((0,i.getAppStore)().dispatch(i.appActions.widgetStatePropChange(p,"settingChangeTab",!1)),lt(t))}),[y,V,Ce,p,lt]),i.React.useEffect((()=>{Ke&&!ke&&He&&He.updateQueryParams(gt,p)}),[He,p,Ke,ke]),i.React.useEffect((()=>{qe&&Oe.current&&setTimeout((()=>{ut()}),300)}),[qe,He,ut]);const pt=i.React.useCallback((e=>{var t,n;if(!Be.getDataSource(null==He?void 0:He.id))return;const a=null===(n=null===(t=He.getInfo())||void 0===t?void 0:t.widgetQueries)||void 0===n?void 0:n[p];let l;e?l=Object.assign(Object.assign({},a),{geometry:e.toJSON()}):(l=Object.assign({},a),delete l.geometry),He.updateQueryParams(l,p)}),[Be,He,p]),ft=i.React.useCallback((()=>{Qe&&(Qe.filterGeometry=null)}),[Qe]),bt=i.lodash.debounce((({width:e,height:t})=>{(e=>{const{enableMapExtentFilter:t}=v,n=t?345:305;e<ht[0]?J(!0):J(!1),X(e<n),K(e<430),te(e)})(e)}),200),yt=()=>{Qe&&Qe.refresh()},wt=()=>{var e;const t=[],n=P.find((e=>e.id===V));if(!n)return t;const{tableFields:l,allFields:o,layerHonorMode:i}=n;if(i===a.Webmap&&He){const n=null===(e=null==He?void 0:He.getPopupInfo)||void 0===e?void 0:e.call(He);if(n){const e=n.fieldInfos||[];for(const n of e)t.push({value:n.fieldName,label:n.label})}else for(const e of o)t.push({value:e.name,label:e.alias})}else for(const e of l)e.visible&&t.push({value:e.name,label:e.alias});return t},St=0===P.length,xt=ze&&(0,i.jsx)(at,{usedState:Ye,curLayerConfig:ze,dataSource:He,dsSelection:ye,isMapMode:N,arrangeType:j,enableMapExtentFilter:I,widgetId:p,enableDataAction:Ee,getInitFields:wt,onShowSelection:()=>{B?(Qe.filterBySelectionEnabled=!1,ot()):Qe.filterBySelectionEnabled=!0,U(!B)},resetTable:()=>{B&&(ot(),U(!1)),i.MessageManager.getInstance().publishMessage(new i.DataRecordsSelectionChangeMessage(p,[],[He.id])),setTimeout((()=>{He.clearSelection(),He.updateQueryParams(gt,p),Qe&&(Qe.highlightIds.removeAll(),Qe.filterBySelectionEnabled=!1)}),500)},onTableRefresh:yt,onDeleteSelection:()=>{Qe&&Qe.deleteSelection(!0)},onValueChangeFromRuntime:e=>{e||(e=[]);const t=wt(),n=ne||t,a=e.length>n.length;z(n,e,"value").forEach((e=>{a?Qe.showColumn(e.value):Qe.hideColumn(e.value)})),ae(e)},toggleMapFilter:()=>{se(!ie)}});return(0,i.jsx)(i.React.Fragment,null,St&&(0,i.jsx)(g.WidgetPlaceholder,{widgetId:p,iconSize:"large",style:{position:"absolute",left:0,top:0},icon:mt,"data-testid":"tablePlaceholder"}),(0,i.jsx)("div",{className:Me,css:C(D,G,ke,Xe),ref:Te},(0,i.jsx)("div",{className:St?"hide-table":"surface-1 border-0 h-100"},(0,i.jsx)("div",{className:"table-indent"},P&&V&&(0,i.jsx)(f,{allLayersConfig:P,isHorizontalTab:Ae,activeTabId:V,onTabClick:lt,onCloseTab:(e,t)=>{t&&t.stopPropagation(),ae(void 0);const n=null==w?void 0:w.viewInTableObj;delete n[e],delete Re.current[e],i.MutableStoreManager.getInstance().updateStateValue(p,"viewInTableObj",n),e===V&&k(P[0].id)},searchOn:ke,toolListNode:xt}),(0,i.jsx)("div",{className:Ae?"horizontal-render-con":"dropdown-render-con"},ze&&ke&&(0,i.jsx)(H,{searchToolTowed:q,curLayerConfig:ze,dataSource:He,tableLoaded:qe,widgetState:S,toolListNode:xt,handleSubmit:nt}),re&&(0,i.jsx)(W,{searchOn:ke,notReady:de,dataSourceLabel:null==He?void 0:He.getLabel(),widgetLabel:Ve}),(0,i.jsx)("div",{className:"table-con",ref:je}),(0,i.jsx)("div",{className:"table-bottom-info"},(0,i.jsx)(Q,{table:Qe,showCount:null==ze?void 0:ze.showCount,onSelectedChange:e=>{oe(e)}}),(void 0===(null==ze?void 0:ze.updateText)||ze.updateText)&&(pe||he>0)&&(0,i.jsx)(ee,{needRefresh:ge,showLoading:pe,interval:he,isMobile:G,bottomResponsive:Y,onRefresh:()=>{fe(!1)}})),N&&(0,i.jsx)(it,{useMapWidgetIds:h,mapViewsConfig:O,mapFilterEnabled:ie,onUpdateViewExtent:pt,onRestTableGeometry:ft,onLayersConfigChange:tt}),(0,i.jsx)(dt,{widgetId:p,curLayerConfig:ze,widgetState:S,onUpdateLayerInfo:e=>{if(!e||!V||!ze)return;const{notReady:t,emptyTable:n,showLoading:a,interval:l,needRefresh:o,selectedRecords:i,selectionViewIds:s}=e;ue(t),ce(n),ve(a),me(l),fe(o),we(i),xe(s)},onTimeExtentChange:e=>{var t,n;const a=null==Qe?void 0:Qe.layer;if(e){const l=i.dataSourceUtils.changeJimuTimeToJSAPITimeExtent(e),o=null==a?void 0:a.timeExtent;!((null==e?void 0:e[0])===(null===(t=null==o?void 0:o.start)||void 0===t?void 0:t.getTime())&&(null==e?void 0:e[1])===(null===(n=null==o?void 0:o.end)||void 0===n?void 0:n.getTime()))&&a&&(a.timeExtent=l)}else a&&(a.timeExtent=null)},onGdbVersionChange:e=>{Qe.layer.gdbVersion=e,yt()},onBelongToSourceVersionChange:()=>{yt()},onNeedRefresh:()=>{yt()},onWidgetQueryChange:()=>{(null==Qe?void 0:Qe.layer)?ut():Oe.current=!0}}),(0,i.jsx)(c.Global,{styles:$e(D)})))),(0,i.jsx)(i.ReactResizeDetector,{targetRef:Te,handleWidth:!0,handleHeight:!0,onResize:bt})))};ft.versionManager=r;const bt=ft;function yt(e){v.p=e}})(),h})())}}}));